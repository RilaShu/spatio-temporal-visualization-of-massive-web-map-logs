!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.tiles=e()}}(function(){return function e(t,i,r){function n(o,s){if(!i[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var u=i[o]={exports:{}};t[o][0].call(u.exports,function(e){var i=t[o][1][e];return n(i?i:e)},u,u.exports,e,t,i,r)}return i[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)n(r[o]);return n}({1:[function(e,t,i){!function(){"use strict";t.exports={AreaOfInterestTilePyramid:e("./binning/AreaOfInterestTilePyramid"),TileIterator:e("./binning/TileIterator"),WebMercatorTilePyramid:e("./binning/WebMercatorTilePyramid"),AnnotationLayer:e("./layer/AnnotationLayer"),AxisLayer:e("./layer/AxisLayer"),BaseLayer:e("./layer/BaseLayer"),KMLLayer:e("./layer/KMLLayer"),ServerLayer:e("./layer/ServerLayer"),ClientLayer:e("./layer/ClientLayer"),MultiUrlClientLayer:e("./layer/MultiUrlClientLayer"),Carousel:e("./layer/Carousel"),LayerUtil:e("./layer/LayerUtil"),VectorLayer:e("./layer/VectorLayer"),HtmlMarker:e("./layer/HtmlMarker"),HtmlMarkerLayer:e("./layer/HtmlMarkerLayer"),Layer:e("./layer/Layer"),Renderer:e("./layer/renderer/Renderer"),Aggregator:e("./layer/renderer/aggregator/Aggregator"),TopicCountAggregator:e("./layer/renderer/aggregator/TopicCountAggregator"),TopicCountArrayAggregator:e("./layer/renderer/aggregator/TopicCountArrayAggregator"),TopicFrequencyAggregator:e("./layer/renderer/aggregator/TopicFrequencyAggregator"),TweetsByTopicAggregator:e("./layer/renderer/aggregator/TweetsByTopicAggregator"),FrequenciesByTopicAggregator:e("./layer/renderer/aggregator/FrequenciesByTopicAggregator"),FrequencyArraysByTopicAggregator:e("./layer/renderer/aggregator/FrequencyArraysByTopicAggregator"),RendererUtil:e("./layer/renderer/RendererUtil"),GraphLabelRenderer:e("./layer/renderer/GraphLabelRenderer"),GraphNodeRenderer:e("./layer/renderer/GraphNodeRenderer"),PointAggregateRenderer:e("./layer/renderer/PointAggregateRenderer"),PointRenderer:e("./layer/renderer/PointRenderer"),TextByFrequencyRenderer:e("./layer/renderer/TextByFrequencyRenderer"),TextScoreWeightedRenderer:e("./layer/renderer/TextScoreWeightedRenderer"),TextByTopicRenderer:e("./layer/renderer/TextByTopicRenderer"),WordCloudRenderer:e("./layer/renderer/WordCloudRenderer"),RenderTheme:e("./layer/renderer/RenderTheme"),Map:e("./map/Map"),MapUtil:e("./map/MapUtil"),Marker:e("./map/Marker"),Axis:e("./map/Axis"),AxisUtil:e("./map/AxisUtil"),AnnotationService:e("./rest/AnnotationService"),LayerService:e("./rest/LayerService"),LegendService:e("./rest/LegendService"),TileService:e("./rest/TileService"),LayerControls:e("./ui/LayerControls"),PubSub:e("./util/PubSub"),Util:e("./util/Util")}}()},{"./binning/AreaOfInterestTilePyramid":2,"./binning/TileIterator":3,"./binning/WebMercatorTilePyramid":4,"./layer/AnnotationLayer":5,"./layer/AxisLayer":6,"./layer/BaseLayer":7,"./layer/Carousel":8,"./layer/ClientLayer":9,"./layer/HtmlMarker":10,"./layer/HtmlMarkerLayer":11,"./layer/KMLLayer":14,"./layer/Layer":15,"./layer/LayerUtil":16,"./layer/MultiUrlClientLayer":17,"./layer/ServerLayer":20,"./layer/VectorLayer":23,"./layer/renderer/GraphLabelRenderer":24,"./layer/renderer/GraphNodeRenderer":25,"./layer/renderer/PointAggregateRenderer":26,"./layer/renderer/PointRenderer":27,"./layer/renderer/RenderTheme":28,"./layer/renderer/Renderer":29,"./layer/renderer/RendererUtil":30,"./layer/renderer/TextByFrequencyRenderer":31,"./layer/renderer/TextByTopicRenderer":32,"./layer/renderer/TextScoreWeightedRenderer":33,"./layer/renderer/WordCloudRenderer":34,"./layer/renderer/aggregator/Aggregator":35,"./layer/renderer/aggregator/FrequenciesByTopicAggregator":36,"./layer/renderer/aggregator/FrequencyArraysByTopicAggregator":37,"./layer/renderer/aggregator/TopicCountAggregator":38,"./layer/renderer/aggregator/TopicCountArrayAggregator":39,"./layer/renderer/aggregator/TopicFrequencyAggregator":40,"./layer/renderer/aggregator/TweetsByTopicAggregator":41,"./map/Axis":42,"./map/AxisUtil":43,"./map/Map":44,"./map/MapUtil":45,"./map/Marker":46,"./rest/AnnotationService":47,"./rest/LayerService":48,"./rest/LegendService":49,"./rest/TileService":50,"./ui/LayerControls":53,"./util/PubSub":59,"./util/Util":60}],2:[function(e,t,i){!function(){"use strict";function e(e){this.minX=e.minX,this.minY=e.minY,this.maxX=e.maxX,this.maxY=e.maxY}e.prototype.getProjection=function(){return"EPSG:4326"},e.prototype.getTileScheme=function(){return"TMS"},e.prototype.fractionalTileToRoot=function(e){var t,i,r;return t=1<<e.level,i=(this.maxX-this.minX)/t,r=(this.maxY-this.minY)/t,{x:this.minX+i*e.xIndex,y:this.minY+r*e.yIndex}},e.prototype.rootToFractionalTile=function(e,t,i,r){r=r||256;var n,a,o;return n=1<<i,a=n*(e-this.minX)/(this.maxX-this.minX),o=n*(t-this.minY)/(this.maxY-this.minY),{level:i,xIndex:a,yIndex:o,xBinCount:r,yBinCount:r}},e.prototype.rootToTile=function(e,t,i,r){var n=this.rootToFractionalTile(e,t,i,r);return n.xIndex=Math.floor(n.xIndex),n.yIndex=Math.floor(n.yIndex),n},e.prototype.rootToFractionalBin=function(e,t,i){var r,n,a,o,s,l,h;return r=1<<i.level,n=(this.maxX-this.minX)/r,a=(this.maxY-this.minY)/r,o=e-this.minX-i.xIndex*n,s=t-this.minY-i.yIndex*a,l=o*i.xBinCount/n,h=s*i.yBinCount/a,{x:l,y:i.yBinCount-1-h}},e.prototype.rootToBin=function(e,t,i){var r=this.rootToFractionalBin(e,t,i);return r.x=Math.floor(r.x),r.y=Math.floor(r.y),r},e.prototype.rootToBin=function(e,t,i){var r,n,a,o,s,l,h;return r=1<<i.level,n=(this.maxX-this.minX)/r,a=(this.maxY-this.minY)/r,o=e-this.minX-i.xIndex*n,s=t-this.minY-i.yIndex*a,l=Math.floor(o*i.xBinCount/n),h=Math.floor(s*i.yBinCount/a),{x:l,y:i.yBinCount-1-h}},e.prototype.getTileBounds=function(e){var t,i,r;return t=1<<e.level,i=(this.maxX-this.minX)/t,r=(this.maxY-this.minY)/t,{minX:this.minX+i*e.xIndex,minY:this.minY+r*e.yIndex,maxX:this.minX+i*(e.xIndex+1),maxY:this.minY+r*(e.yIndex+1),centerX:this.minX+i*(e.xIndex+.5),centerY:this.minY+r*(e.yIndex+.5),width:i,height:r}},e.prototype.getBinBounds=function(e,t){var i,r,n,a,o,s,l,h;return i=1<<e.level,r=(this.maxX-this.minX)/i,n=(this.maxY-this.minY)/i,a=r/e.xBinCount,o=n/e.yBinCount,s=e.yBinCount-1-t.y,l=this.minX+r*e.xIndex,h=this.minY+n*e.yIndex,{minX:l+a*t.x,minY:h+o*s,maxX:l+a*(t.x+1),maxY:h+o*(s+1),centerX:l+a*(t.x+.5),centerY:h+o*(s+.5),width:a,height:o}},e.prototype.toJSON=function(){return'{"type": "AreaOfInterest","minX": this.minX,"maxX": this.maxX,"minY": this.minY,"maxY": this.maxY}'},t.exports=e}()},{}],3:[function(e,t,i){!function(){"use strict";function e(e){this.pyramid=e.pyramid,this.level=e.level,this.minTile=e.pyramid.rootToTile(e.minX,e.minY,e.level),this.maxTile=e.pyramid.rootToTile(e.maxX,e.maxY,e.level),this.curX=this.minTile.xIndex,this.curY=this.minTile.yIndex}e.prototype.hasNext=function(){return this.curX<=this.maxTile.xIndex&&this.curY<=this.maxTile.yIndex},e.prototype.next=function(){var e={xIndex:this.curX,yIndex:this.curY,level:this.level,xBinCount:256,yBinCount:256};return this.curX=this.curX+1,this.curX>this.maxTile.xIndex&&(this.curX=this.minTile.xIndex,this.curY=this.curY+1),e},e.prototype.getRest=function(){for(var e=[];this.hasNext();)e[e.length]=this.next();return e},e.prototype.toString=function(){for(var e,t="";this.hasNext();)t.length>0&&(t+="|"),e=this.next(),t=t+"["+e.xIndex+"/"+e.xBinCount+","+e.yIndex+"/"+e.yBinCount+", lvl "+e.level+"]";return t},e.prototype.toTileBounds=function(){return{minX:this.minTile.xIndex,maxX:this.maxTile.xIndex,minY:this.minTile.yIndex,maxY:this.maxTile.yIndex,minZ:this.level,maxZ:this.level}},t.exports=e}()},{}],4:[function(e,t,i){!function(){"use strict";function e(e,t,i){var r=t*u,n=1<<i,a=(e+180)/360*n,o=n*(1-Math.log(Math.tan(r)+1/Math.cos(r))/Math.PI)/2;return{x:a,y:n-o}}function i(e){return(Math.exp(e)-Math.exp(-e))/2}function r(e,t){var i=1<<t;return e/i*360-180}function n(e,t){var r=1<<t,n=-Math.PI+2*Math.PI*e/r;return Math.atan(i(n))*c}function a(e){function t(e){return Math.atan(i(e))*c}return t(e/h*Math.PI)}function o(e){function t(e){var t=0!==e?e/Math.abs(e):0,i=Math.sin(e*u*t);return t*(Math.log((1+i)/(1-i))/2)}return t(e)/Math.PI*h}function s(){return this.minX=-180,this.minY=-85.05,this.maxX=180,this.maxY=85.05,this}var l=20037508.342789244,h=85.05112878,u=Math.PI/180,c=180/Math.PI;s.prototype.getProjection=function(){return"EPSG:900913"},s.prototype.getTileScheme=function(){return"TMS"},s.prototype.fractionalTileToRoot=function(e){return{lon:r(e.xIndex,e.level),lat:n(e.yIndex,e.level)}},s.prototype.rootToFractionalTile=function(t,i,r,n){n=n||256;var a=e(t,i,r);return{level:r,xIndex:a.x,yIndex:a.y,xBinCount:n,yBinCount:n}},s.prototype.rootToTile=function(e,t,i,r){var n=this.rootToFractionalTile(e,t,i,r);return n.xIndex=Math.floor(n.xIndex),n.yIndex=Math.floor(n.yIndex),n},s.prototype.rootToFractionalBin=function(t,i,r){var n=e(t,i,r.level);return{x:(n.x-r.xIndex)*r.xBinCount,y:r.yBinCount-1-(n.y-r.yIndex)*r.yBinCount}},s.prototype.rootToBin=function(e,t,i){var r=this.rootToFractionalBin(e,t,i);return r.x=Math.floor(r.x),r.y=Math.floor(r.y),r},s.prototype.getEPSG900913Bounds=function(e,t){var i,r,n,s,h,u,c,p=1<<e.level,d=1/p,y=e.xIndex*d-.5,m=e.yIndex*d-.5;return t?(i=y+d,r=m+d):(h=d/e.xBinCount,u=d/e.yBinCount,y+=t.x*h,m+=(e.yBinCount-t.y-1)*u,i=y+h,r=m+u),s=o(r),n=o(m),c=a((s+n)/2),{minX:2*y*l,minY:2*m*l,maxX:2*i*l,maxY:2*r*l,centerX:(y+i)*l,centerY:2*c*l,width:2*(i-y)*l,height:2*(r-m)*l}},s.prototype.getTileBounds=function(e){var t=e.level,i=n(e.yIndex+1,t),s=n(e.yIndex,t),l=r(e.xIndex+1,t),h=r(e.xIndex,t),u=o(i),c=o(s),p=a((u+c)/2);return{minX:h,minY:s,maxX:l,maxY:i,centerX:(l+h)/2,centerY:p,width:l-h,height:i-s}},s.prototype.getBinBounds=function(e,t){var i=e.level,s=1/e.xBinCount,l=e.xIndex+t.x*s,h=1/e.yBinCount,u=e.yIndex+(e.yBinCount-1-t.y)*h,c=n(u+h,i),p=n(u,i),d=r(l+s,i),y=r(l,i),m=o(c),f=o(p),g=a((m+f)/2);return{minX:y,minY:p,maxX:d,maxY:c,centerX:(d+y)/2,centerY:g,width:d-y,height:c-p}},s.prototype.toJSON=function(){return'{"type": "WebMercator"}'},t.exports=s}()},{}],5:[function(e,t,i){!function(){"use strict";function i(e){return void 0===e.x?(console.error("Annotation argument is missing the 'x' attribute"),!1):void 0===e.y?(console.error("Annotation argument is missing the 'y' attribute"),!1):void 0===e.level?(console.error("Annotation argument is missing the 'level' attribute"),!1):void 0===e.range?(console.error("Annotation argument is missing the 'range' attribute"),!1):void 0===e.group?(console.error("Annotation argument is missing the 'group' attribute"),!1):void 0!==e.data||(console.error("Annotation argument is missing the 'data' attribute"),!1)}function r(e){var t=this,i=e.getURL||a.getURL;n.call(this,e),this.zIndex=void 0!==e.zIndex?parseInt(e.zIndex,10):500,this.filter=e.filter||{},this.domain="annotation",this.source=e.source,this.getURL=function(e){return i.call(this,e)+t.getQueryParamString()},e.tileClass&&(this.tileClass=e.tileClass),e.renderer&&this.setRenderer(e.renderer)}var n=e("./Layer"),a=e("./LayerUtil"),o=e("../util/Util"),s=e("../rest/AnnotationService"),l=e("./HtmlTileLayer"),h=e("../util/PubSub");r.prototype=Object.create(n.prototype),r.prototype.activate=function(){this.olLayer=new l("Annotation Tile Layer",this.source.tms,{layername:this.source.id,type:"json",maxExtent:new OpenLayers.Bounds((-20037500),(-20037500),20037500,20037500),isBaseLayer:!1,getURL:this.getURL,tileClass:this.tileClass,renderer:this.renderer}),this.setEnabled(this.isEnabled()),this.setTheme(this.map.getTheme()),this.setOpacity(this.getOpacity()),this.setBrightness(this.getBrightness()),this.setContrast(this.getContrast()),h.publish(this.getChannel(),{field:"activate",value:!0}),this.map.olMap.addLayer(this.olLayer),this.setZIndex(this.zIndex),h.publish(this.getChannel(),{field:"add",value:!0})},r.prototype.deactivate=function(){this.olLayer&&(this.map.olMap.removeLayer(this.olLayer),h.publish(this.getChannel(),{field:"remove",value:!0}),this.olLayer.destroy(),this.olLayer=null),h.publish(this.getChannel(),{field:"deactivate",value:!0})},r.prototype.setRenderer=function(e){this.renderer=e,this.renderer.attach(this)},r.prototype.setTheme=function(e){this.theme=e},r.prototype.getTheme=function(){return this.theme},r.prototype.setZIndex=function(e){this.zIndex=e,this.olLayer&&$(this.olLayer.div).css("z-index",e),h.publish(this.getChannel(),{field:"zIndex",value:e})},r.prototype.getZIndex=function(){return this.zIndex},r.prototype.write=function(e,t){i(e)&&s.writeAnnotation(this.source.id,e,function(){t()})},r.prototype.modify=function(e,t){i(e)&&s.modifyAnnotation(this.source.id,e,function(){t()})},r.prototype.remove=function(e,t){s.removeAnnotation(this.source.id,e,function(){t()})},r.prototype.setFilterType=function(e){this.filter.type!==e&&(this.filter.type=e,this.redraw(),h.publish(this.getChannel(),{field:"filterType",value:e}))},r.prototype.getFilterType=function(){return this.filter.type},r.prototype.setFilterData=function(e){this.filter.data!==e&&(this.filter.data=e,this.redraw(),h.publish(this.getChannel(),{field:"filterData",value:e}))},r.prototype.getFilterData=function(){return this.filter.data||{}},r.prototype.getQueryParamString=function(){var e={filter:this.filter};return o.encodeQueryParams(e)},r.prototype.redraw=function(){this.olLayer&&(this.olLayer.redraw(),this.olLayer.map&&this.olLayer.map.tileManager&&this.olLayer.map.tileManager.updateTimeout(this.olLayer.map,this.olLayer.map.tileManager.zoomDelay,!0))},t.exports=r}()},{"../rest/AnnotationService":47,"../util/PubSub":59,"../util/Util":60,"./HtmlTileLayer":13,"./Layer":15,"./LayerUtil":16}],6:[function(e,t,i){!function(){"use strict";function i(e){r.call(this,e),this.zIndex=void 0!==e.zIndex?parseInt(e.zIndex,10):1500,this.domain="axis",this.source=e.source,this.getURL=e.getURL||n.getURL,this.dimension=e.dimension||"x",e.tileClass&&(this.tileClass=e.tileClass),e.renderer&&this.setRenderer(e.renderer)}var r=e("./Layer"),n=e("./LayerUtil"),a=e("./UnivariateTileLayer"),o=e("../util/PubSub");i.prototype=Object.create(r.prototype),i.prototype.activate=function(){this.olLayer=new a("Axis Rendered Tile Layer",this.source.tms,{layername:this.source.id,type:"json",maxExtent:new OpenLayers.Bounds((-20037500),(-20037500),20037500,20037500),isBaseLayer:!1,getURL:this.getURL,tileClass:this.tileClass,renderer:this.renderer,dimension:this.dimension}),this.setEnabled(this.isEnabled()),this.setTheme(this.map.getTheme()),this.setOpacity(this.getOpacity()),this.setBrightness(this.getBrightness()),this.setContrast(this.getContrast()),o.publish(this.getChannel(),{field:"activate",value:!0}),this.map.olMap.addLayer(this.olLayer),this.setZIndex(this.zIndex),o.publish(this.getChannel(),{field:"add",value:!0})},i.prototype.deactivate=function(){this.olLayer&&(this.map.olMap.removeLayer(this.olLayer),o.publish(this.getChannel(),{field:"remove",value:!0}),this.olLayer.destroy(),this.olLayer=null),o.publish(this.getChannel(),{field:"deactivate",value:!0})},i.prototype.setRenderer=function(e){this.renderer=e,this.renderer.attach(this)},i.prototype.setTheme=function(e){this.theme=e},i.prototype.getTheme=function(){return this.theme},i.prototype.setZIndex=function(e){this.zIndex=e,this.olLayer&&$(this.olLayer.div).css("z-index",e),o.publish(this.getChannel(),{field:"zIndex",value:e})},i.prototype.getZIndex=function(){return this.zIndex},i.prototype.redraw=function(){this.olLayer&&(this.olLayer.redraw(),this.olLayer.map&&this.olLayer.map.tileManager&&this.olLayer.map.tileManager.updateTimeout(this.olLayer.map,this.olLayer.map.tileManager.zoomDelay,!0))},t.exports=i}()},{"../util/PubSub":59,"./Layer":15,"./LayerUtil":16,"./UnivariateTileLayer":22}],7:[function(e,t,i){!function(){"use strict";function i(e){e=e||{},r.call(this,e),this.type=e.type||"blank",this.url=e.url,this.attribution=e.attribution,this.options=e.options||{color:"rgb(0,0,0)"},this.domain="base"}var r=e("./Layer"),n=e("../util/PubSub");i.prototype=Object.create(r.prototype),i.prototype.activate=function(){var e;switch(this.type.toLowerCase()){case"blank":this.olLayer=new OpenLayers.Layer.Vector("BaseLayer",{});var t=$(this.map.getElement());t.css("background-color",""),t.attr("style",t.attr("style")+"; background-color: "+this.options.color+" !important");break;case"google":this.options.styles&&(this.options.type="styled"),this.olLayer=new OpenLayers.Layer.Google("BaseLayer",this.options);break;case"tms":this.olLayer=new OpenLayers.Layer.TMS("BaseLayer",this.url,this.options);break;case"xyz":this.olLayer=new OpenLayers.Layer.XYZ("BaseLayer",this.url,this.options)}if(this.attribution&&$(this.map.getElement()).append("<div class=baselayer-attribution>"+this.attribution+"</div>"),n.publish(this.getChannel(),{field:"activate",value:!0}),this.map.olMap.addLayer(this.olLayer),this.map.olMap.setBaseLayer(this.olLayer),this.options.styles&&(e=new google.maps.StyledMapType(this.options.styles,{name:"Styled Map"}),this.olLayer.mapObject.mapTypes.set("styled",e)),this.olLayer.mapObject){var i=this.olLayer.mapObject.getDiv();$(i).css("background-color","rgba(0,0,0,0)")}$(this.olLayer.div).css("z-index",-1),this.setOpacity(this.getOpacity()),this.setEnabled(this.isEnabled()),this.setBrightness(this.getBrightness()),this.setContrast(this.getContrast()),n.publish(this.getChannel(),{field:"add",value:!0})},i.prototype.deactivate=function(){this.olLayer&&(this.map.olMap.removeLayer(this.olLayer),n.publish(this.getChannel(),{field:"remove",value:!0}),this.olLayer.destroy()),this.attribution&&$(this.map.getElement()).find(".baselayer-attribution").remove(),this.map.getElement().style["background-color"]="",n.publish(this.getChannel(),{field:"deactivate",value:!0})},i.prototype.resetZIndex=function(){this.olLayer&&$(this.olLayer.div).css("z-index",-1),n.publish(this.getChannel(),{field:"zIndex",value:-1})},t.exports=i}()},{"../util/PubSub":59,"./Layer":15}],8:[function(e,t,i){!function(){"use strict";function i(e){return function(t){var i=u.getTileIndex(this,t),r=i.xIndex,n=i.yIndex,a=i.level,o=a+","+r+","+n,s=e.getLayerIndexForTile(o),l=e.layerSpecs[s],h=l.type,c=l.url,p=l.layername;if(r>=0&&n>=0)return c+p+"/"+a+"/"+r+"/"+n+"."+h}}function r(e){return function(t){var i=u.getTilekey(this,t),r=e.getLayerIndexForTile(i),n=e.layerSpecs[r];return n.renderer}}function n(e,t){var i,r,n;for(r=0;r<e.grid.length;r++)for(i=e.grid[r],n=0;n<i.length;n++)if(i[n].tilekey===t)return void i[n].draw(!0)}function a(e,t){t.setOpacity=function(t){var i;for(e.setOpacity(t),i=0;i<e.layers.length;i++)d.publish(e.layers[i].getChannel(),{field:"opacity",value:t})},t.getOpacity=function(){return e.getOpacity()},t.isEnabled=function(){return!!e.isEnabled()&&e.layers.indexOf(t)===e.defaultIndex},t.setEnabled=function(i){var r;if(i)for(e.setEnabled(!0),e.setTileLayerIndices(e.layers.indexOf(t)),d.publish(t.getChannel(),{field:"enabled",value:i}),r=0;r<e.layers.length;r++)e.layers[r]!==t&&d.publish(e.layers[r].getChannel(),{field:"enabled",value:!1});else e.setEnabled(!1),d.publish(t.getChannel(),{field:"enabled",value:!1})},t.setZIndex=function(t){e.setZIndex(t)},t.getZIndex=function(){return e.getZIndex()},t.setTheme=function(t){e.setTheme(t)},t.redraw=function(){e.olLayer.redraw()}}function o(e,t){e.setOpacity=t.setOpacity,e.getOpacity=t.getOpacity,e.isEnabled=t.isEnabled,e.setEnabled=t.setEnabled,e.setZIndex=t.setZIndex,e.setTheme=t.setTheme,e.redraw=t.redraw}function s(){l.call(this,{}),this.zIndex=1500,this.domain="carousel",this.layers=[],this.layerSpecs=[],this.indicesByTile={},this.defaultIndex=0}var l=e("./Layer"),h=e("./ClientLayer"),u=e("./LayerUtil"),c=e("../util/Util"),p=e("./HtmlTileLayer"),d=e("../util/PubSub");s.prototype=Object.create(h.prototype),s.prototype.addLayer=function(e){if(!(e instanceof h))return void console.log("Only ClientLayers can be added to a carousel object.");if(!this.map)return this.deferreds=this.deferreds||[],void this.deferreds.push(e);var t={url:e.source.tms,type:"json",layername:e.source.id,setOpacity:e.setOpacity,getOpacity:e.getOpacity,isEnabled:e.isEnabled,setEnabled:e.setEnabled,setZIndex:e.setZIndex,setTheme:e.setTheme,redraw:e.redraw};e.renderer&&(t.renderer=e.renderer,t.renderer.meta=e.source.meta.meta,t.renderer.parent=this),e.carousel=this,this.layerSpecs.push(t),this.layers.push(e),a(this,e)},s.prototype.removeLayer=function(e){if(!this.map&&this.deferreds)return void this.deferreds.splice(this.deferreds.indexOf(e),1);var t=this.layers.indexOf(e);if(t!==-1){if(1===this.layers.length&&this.map)return void console.log("A carousel must have at least one layer to be attached to a map, remove the carousel from the map first.");e.renderer&&(e.renderer.parent=e),delete e.carousel,o(e,this.layerSpecs[t]),this.layers.splice(t,1),this.layerSpecs.splice(t,1),(t<this.defaultIndex||this.defaultIndex===this.layers.length)&&this.defaultIndex--,this.setTileLayerIndices(this.defaultIndex)}},s.prototype.activate=function(){if(0===this.layers.length&&(!this.deferreds||0===this.deferreds.length))return void console.log("A carousel must have at least one layer attached before it can be added to a map.");this.olLayer=new p("Client Rendered Carousel Tile Layer",null,{layername:null,type:"json",maxExtent:new OpenLayers.Bounds((-20037500),(-20037500),20037500,20037500),isBaseLayer:!1,getURL:i(this),renderer:r(this)}),this.map.olMap.addLayer(this.olLayer),this.setZIndex(this.zIndex),this.setOpacity(this.opacity),this.setEnabled(this.enabled),this.setTheme(this.map.getTheme());var e;for(e=0;e<this.layers.length;e++)this.map.remove(this.layers[e]);if(this.deferreds){for(e=0;e<this.deferreds.length;e++)this.addLayer(this.deferreds[e]);delete this.deferreds}},s.prototype.incrementTileLayerIndex=function(e){void 0===this.indicesByTile[e]?this.indicesByTile[e]=(this.defaultIndex+1)%this.layers.length:(this.indicesByTile[e]=(this.indicesByTile[e]+1)%this.layers.length,this.indicesByTile[e]===this.defaultIndex&&delete this.indicesByTile[e]),n(this.olLayer,e)},s.prototype.decrementTileLayerIndex=function(e){void 0===this.indicesByTile[e]?this.indicesByTile[e]=c.mod(this.defaultIndex-1,this.layers.length):(this.indicesByTile[e]=c.mod(this.indicesByTile[e]-1,this.layers.length),this.indicesByTile[e]===this.defaultIndex&&delete this.indicesByTile[e]),n(this.olLayer,e)},s.prototype.setTileLayerIndex=function(e,t){t===this.defaultIndex?delete this.indicesByTile[e]:this.indicesByTile[e]=t,n(this.olLayer,e)},s.prototype.setTileLayerIndices=function(e){this.defaultIndex=c.mod(e,this.layers.length),this.indicesByTile={},this.olLayer.redraw()},s.prototype.getLayerIndexForTile=function(e){var t=this.indicesByTile[e];return void 0!==t?t:this.defaultIndex},s.prototype.getRendererForTile=function(e){var t=this.getLayerIndexForTile(e);return this.layers[t].renderer},t.exports=s}()},{"../util/PubSub":59,"../util/Util":60,"./ClientLayer":9,"./HtmlTileLayer":13,"./Layer":15,"./LayerUtil":16}],9:[function(e,t,i){!function(){"use strict";function i(e){return function(){e.olLayer&&e.setLevelMinMax()}}function r(e){var t=this,i=e.getURL||a.getURL;n.call(this,e),this.zIndex=void 0!==e.zIndex?parseInt(e.zIndex,10):1e3,this.tileTransform=e.tileTransform||{},this.domain="client",this.source=e.source,this.getURL=function(e){return i.call(this,e)+t.getQueryParamString()},e.tileClass&&(this.tileClass=e.tileClass),e.renderer&&this.setRenderer(e.renderer),e.aggregators&&_.forIn(e.aggregators,function(e,t){this.addAggregator(t,e)})}var n=e("./Layer"),a=e("./LayerUtil"),o=e("../util/Util"),s=e("./HtmlTileLayer"),l=e("../util/PubSub");r.prototype=Object.create(n.prototype),r.prototype.activate=function(){this.zoomCallback=i(this),this.map.on("zoomend",this.zoomCallback),this.olLayer=new s("Client Rendered Tile Layer",this.source.tms,{layername:this.source.id,type:"json",maxExtent:new OpenLayers.Bounds((-20037500),(-20037500),20037500,20037500),isBaseLayer:!1,getURL:this.getURL,tileClass:this.tileClass,renderer:this.renderer}),this.setEnabled(this.isEnabled()),this.setTheme(this.map.getTheme()),this.setOpacity(this.getOpacity()),this.setBrightness(this.getBrightness()),this.setContrast(this.getContrast()),l.publish(this.getChannel(),{field:"activate",value:!0}),this.map.olMap.addLayer(this.olLayer),this.setZIndex(this.zIndex),this.setLevelMinMax(),l.publish(this.getChannel(),{field:"add",value:!0})},r.prototype.deactivate=function(){this.olLayer&&(this.map.olMap.removeLayer(this.olLayer),l.publish(this.getChannel(),{field:"remove",value:!0}),this.olLayer.destroy(),this.olLayer=null),this.map.off("zoomend",this.zoomCallback),this.zoomCallback=null,l.publish(this.getChannel(),{field:"deactivate",value:!0})},r.prototype.setRenderer=function(e){this.renderer=e,this.renderer.attach(this)},r.prototype.addAggregator=function(e,t){this.aggregators=this.aggregators||{},this.aggregators[e]=t,this.aggregators[e].attach(this)},r.prototype.getAggregator=function(e){return this.aggregators[e]},r.prototype.setTheme=function(e){this.theme=e},r.prototype.getTheme=function(){return this.theme},r.prototype.setZIndex=function(e){this.zIndex=e,this.olLayer&&$(this.olLayer.div).css("z-index",e),l.publish(this.getChannel(),{field:"zIndex",value:e})},r.prototype.getZIndex=function(){return this.zIndex},r.prototype.setTileTransformType=function(e){this.tileTransform.type!==e&&(this.tileTransform.type=e,this.redraw(),l.publish(this.getChannel(),{field:"tileTransformType",value:e}))},r.prototype.getTileTransformType=function(){return this.tileTransform.type},r.prototype.setTileTransformRange=function(e,t){var i=this.source.meta.meta,r=i.rangeMin,n=i.rangeMax,a=i.bucketCount,o=(n-r)/a;e>n&&t<r&&this.setTileTransformData({startBucket:-1,endBucket:-1}),this.setTileTransformData({startBucket:Math.max(0,Math.floor((e-r)/o)),endBucket:Math.min(a-1,Math.floor((t-r)/o))})},r.prototype.setTileTransformData=function(e){_.isEqual(this.tileTransform.data,e)||(this.tileTransform.data=e,this.redraw(),l.publish(this.getChannel(),{field:"tileTransformData",value:e}))},r.prototype.getTileTransformData=function(){return this.tileTransform.data||{}},r.prototype.getLevelMinMax=function(){return this.levelMinMax},r.prototype.getQueryParamString=function(){var e={tileTransform:this.tileTransform};return o.encodeQueryParams(e)},r.prototype.redraw=function(){this.olLayer&&(this.setLevelMinMax(),this.olLayer.redraw(),this.setZIndex(this.zIndex),this.olLayer.map&&this.olLayer.map.tileManager&&this.olLayer.map.tileManager.updateTimeout(this.olLayer.map,this.olLayer.map.tileManager.zoomDelay,!0))},r.prototype.setLevelMinMax=function(){var e,t=this.map.getZoom(),i=this.source,r=i.meta&&i.meta.meta?i.meta.meta[t]:null,n=this.tileTransform.data||{},a=r,o=this.renderer;r?o&&o.aggregator&&(e=o.aggregator.aggregate(r.bins||[],n.startBucket,n.endBucket),a=e instanceof Array?{minimum:e[e.length-1]||null,maximum:e[0]||null}:{minimum:e,maximum:e}):a={minimum:null,maximum:null},this.levelMinMax=a,l.publish(this.getChannel(),{field:"levelMinMax",value:a})},t.exports=r}()},{"../util/PubSub":59,"../util/Util":60,"./HtmlTileLayer":13,"./Layer":15,"./LayerUtil":16}],10:[function(e,t,i){!function(){"use strict";function i(e,t,i,r){this.x=e,this.y=t,this.html=i,this.dimension=r,this.icon=new OpenLayers.Icon(null,new OpenLayers.Size(2,2),new OpenLayers.Pixel((-1),(-2)))}var r=e("../map/MapUtil");i.prototype={activate:function(){var e=r.getViewportPixelFromCoord(this.map,this.x,this.y),t=this.map.olMap.getLonLatFromViewPortPx(e);this.olMarker=new OpenLayers.Marker(t,this.icon.clone()),this.layer.olLayer.addMarker(this.olMarker);var i=$(this.olMarker.icon.imageDiv);i.children().css("display","none"),this.$elem=$(this.html),this.$container=i.parent(),this.$olContainer=this.$container.parent(),this.dimension&&(this.updatePosition=this.updatePosition.bind(this),this.map.olMap.events.register("move",this.map.olMap,this.updatePosition)),i.append(this.html)},deactivate:function(){this.olMarker&&this.layer.olLayer&&(this.layer.olLayer.removeMarker(this.olMarker),this.map.olMap.events.unregister("move",this.map.olMap,this.updatePosition),this.olMarker.destroy(),this.olMarker=null,this.$elem=null)},disable:function(){this.map.olMap.events.unregister("move",this.map.olMap,this.updatePosition)},moveTo:function(e,t){this.x=e,this.y=t;var i=r.getViewportPixelFromCoord(this.map,this.x,this.y),n=this.map.olMap.getLonLatFromViewPortPx(i),a=this.map.olMap.getLayerPxFromLonLat(n);this.olMarker.moveTo(a)},updatePosition:function(){var e=this.$olContainer,t=e.position();"x"===this.dimension&&this.$elem.parent().css("top",-t.top+"px")}},t.exports=i}()},{"../map/MapUtil":45}],11:[function(e,t,i){!function(){"use strict";function i(e,t){t.layer=e,t.map=e.map,t.activate()}function r(e){e.deactivate(),e.map=null,e.layer=null}function n(e){e=e||{},a.call(this,e),this.zIndex=void 0!==e.zIndex?e.zIndex:749,this.domain="marker",this.source=e.source,this.markers=e.markers||[]}var a=e("./Layer"),o=e("../util/PubSub");n.prototype=Object.create(a.prototype),n.prototype.activate=function(){this.olLayer=new OpenLayers.Layer.Markers("Markers"),this.setOpacity(this.opacity),this.setEnabled(this.enabled),this.setTheme(this.map.getTheme()),this.map.olMap.addLayer(this.olLayer),this.markers.forEach(function(e){i(this,e)},this),this.setZIndex(this.zIndex),o.publish(this.getChannel(),{field:"activate",value:!0})},n.prototype.deactivate=function(){this.olLayer&&(this.olLayer.clearMarkers(),this.map.olMap.removeLayer(this.olLayer),this.olLayer.destroy(),this.olLayer=null,o.publish(this.getChannel(),{field:"deactivate",value:!0}))},n.prototype.addMarker=function(e){this.olLayer&&i(this,e),this.markers.push(e)},n.prototype.addMarkers=function(e,t,i){var r=this;t?_.chunk(e,t).forEach(function(e,t){setTimeout(function(){e.forEach(function(e){r.addMarker(e)})},i*t||0)}):e.forEach(function(e){r.addMarker(e)})},n.prototype.disableMarkers=function(){this.markers.forEach(function(e){e.disable()})},n.prototype.removeMarker=function(e){this.olLayer&&r(e)},n.prototype.clearMarkers=function(){this.olLayer&&(this.disableMarkers(),this.olLayer.clearMarkers()),this.markers=[]},n.prototype.setTheme=function(e){this.theme=e},n.prototype.setZIndex=function(e){this.zIndex=e,this.olLayer&&($(this.olLayer.div).css("z-index",e),o.publish(this.getChannel(),{field:"zIndex",value:e}))},n.prototype.getZIndex=function(){return this.zIndex},t.exports=n}()},{"../util/PubSub":59,"./Layer":15}],12:[function(e,t,i){!function(){"use strict";OpenLayers.Tile.HTML=function(){this.url=null,this.imgDiv=null,this.imageReloadAttempts=null,OpenLayers.Tile.apply(this,arguments)},OpenLayers.Tile.HTML.prototype=Object.create(OpenLayers.Tile.prototype),OpenLayers.Tile.HTML.prototype.destroy=function(){this.imgDiv&&(this.clear(),this.imgDiv=null),OpenLayers.Tile.prototype.destroy.apply(this,arguments)},OpenLayers.Tile.HTML.prototype.draw=function(){var e=OpenLayers.Tile.prototype.draw.apply(this,arguments);return e?(this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.renderTile(),this.positionTile()):e===!1&&this.unload(),e},OpenLayers.Tile.HTML.prototype.getURL=function(){var e=this.layer.getURL(this.bounds);return e instanceof Array&&(e=e.join("|")),e},OpenLayers.Tile.HTML.prototype.renderTile=function(){this.url=this.getURL(),this.initImage()},OpenLayers.Tile.HTML.prototype.positionTile=function(){var e=this.getTile().style,t=this.layer.getImageSize(this.bounds),i=1;this.layer instanceof OpenLayers.Layer.Grid&&(i=this.layer.getServerResolution()/this.layer.map.getResolution()),e.left=this.position.x+"px",e.top=this.position.y+"px",e.width=Math.round(i*t.w)+"px",e.height=Math.round(i*t.h)+"px"},OpenLayers.Tile.HTML.prototype.clear=function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var e=this.imgDiv;if(e){var t=this.getTile();t.parentNode===this.layer.div&&this.layer.div.removeChild(t),
this.setImgSrc(),OpenLayers.Element.removeClass(e,"olImageLoadError")}},OpenLayers.Tile.HTML.prototype.getImage=function(){if(!this.imgDiv){this.imgDiv=document.createElement("div"),this.imgDiv.className="olTileHtml";var e=this.imgDiv.style;e.visibility="hidden",e.opacity=0,this.layer.opacity<1&&(e.filter="alpha(opacity="+100*this.layer.opacity+")"),e.position="absolute"}return this.imgDiv},OpenLayers.Tile.HTML.prototype.setImage=function(e){this.imgDiv=e},OpenLayers.Tile.HTML.prototype.initImage=function(){if(!this.url&&!this.imgDiv)return void(this.isLoading=!1);this.events.triggerEvent("beforeload"),this.layer.div.appendChild(this.getTile()),this.events.triggerEvent(this._loadEvent);var e=this.getImage(),t=e.getAttribute("data-url")||"";t===this.url?this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,this),0):(this.stopLoading(),this.imageReloadAttempts=0,this.setImgSrc(this.url))},OpenLayers.Tile.HTML.prototype.setImgSrc=function(e){var t=this,i=this.imgDiv;if(e){var r=e.split("|");i.style.visibility="hidden",i.style.opacity=0,i.setAttribute("data-url",e);var n=r.map(function(e){var t=$.Deferred();return $.ajax({url:e}).then(function(e){t.resolve(e)},function(e){t.reject(),console.error(e.responseText),console.error(e)}),t});$.when.apply($,n).then(function(){e===t.url&&t.onImageLoad.apply(t,arguments)},function(){e===t.url&&t.onImageError()})}else this.stopLoading(),this.imgDiv=null,i.parentNode&&i.parentNode.removeChild(i)},OpenLayers.Tile.HTML.prototype.getTile=function(){return this.getImage()},OpenLayers.Tile.HTML.prototype.createBackBuffer=function(){},OpenLayers.Tile.HTML.prototype.renderHtml=function(){var e,t,i,r=this.imgDiv,n=r._tileData,a=this.getRenderer();if(r.innerHTML="",a.spec.hideTile&&(r.className=r.className+" hideTile"),n&&0!==n.length){var o=!1;if(n.forEach(function(e){(e.tile||e.hits)&&(o=!0)}),o){if(e=a.aggregator){var s=0;if(n.forEach(function(t){if(t.tile){if(!t.tile.meta.aggregated||t.tile.meta.aggregationType!==e){var i=t.tile.meta.map?t.tile.meta.map.bins:t.tile.meta.raw;t.tile.meta={raw:i,aggregated:e.aggregate(i)},t.tile.meta.aggregationType=e}0===t.tile.meta.aggregated.length&&s++}}),s===n.length)return}var l=1===n.length?n[0]:n;i=a.render(l),t=i.html,this.entries=i.entries,t instanceof $?$(r).append(t):t instanceof HTMLElement?r.appendChild(t):r.innerHTML=t,a.injectEntries(r.children,this.entries),a.executeHooks(r.children,this.entries,l)}}},OpenLayers.Tile.HTML.prototype.getRenderer=function(){var e=this.layer.renderer;return"function"==typeof e&&(e=e.call(this.layer,this.bounds)),e},OpenLayers.Tile.HTML.prototype.onImageLoad=function(){var e=this.imgDiv;if(this.stopLoading(),e){if(e.style.visibility="inherit",e.style.opacity=this.layer.opacity,arguments.length>0){var t,i=[];for(t=0;t<arguments.length;t++)i.push(arguments[t]);e._tileData=i}this.renderHtml(),this.isLoading=!1,this.events.triggerEvent("loadend")}},OpenLayers.Tile.HTML.prototype.onImageError=function(){var e=this.imgDiv;e&&e.getAttribute("data-url")&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.getURL()):(OpenLayers.Element.addClass(e,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},OpenLayers.Tile.HTML.prototype.stopLoading=function(){window.clearTimeout(this._loadTimeout),delete this._loadTimeout},OpenLayers.Tile.HTML.prototype.getCanvasContext=function(){},OpenLayers.TileManager&&(OpenLayers.TileManager.prototype.addTile=function(e){e.tile instanceof OpenLayers.Tile.Image||e.tile instanceof OpenLayers.Tile.HTML||e.tile instanceof OpenLayers.Tile.Univariate?e.tile.layer.singleTile||e.tile.events.on({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this}):this.removeLayer({layer:e.tile.layer})},OpenLayers.TileManager.prototype.queueTileDraw=function(e){var t=e.object,i=!1,r=t.layer,n=t.getURL?t.getURL():r.getURL(t.bounds),a=this.tileCache[n];if(!a||OpenLayers.Element.hasClass(a,"olTileImage")||OpenLayers.Element.hasClass(a,"olTileHtml")||OpenLayers.Element.hasClass(a,"olTileUnivariate")||(delete this.tileCache[n],OpenLayers.Util.removeItem(this.tileCacheIndex,n),a=null),r.url&&(r.async||!a)){var o=this.tileQueue[r.map.id];~OpenLayers.Util.indexOf(o,t)||o.push(t),i=!0}return!i}),OpenLayers.Tile.Image.prototype.createBackBuffer=function(){},t.exports=OpenLayers.Tile.HTML}()},{}],13:[function(e,t,i){!function(){"use strict";var i=e("./HtmlTile");OpenLayers.Layer.HTML=function(e,t,r){OpenLayers.Layer.Grid.call(this,e,t,r),this.getURL=r.getURL,this.layername=r.layername,this.type=r.type,this.tileClass=r.tileClass||i,this.html=r.html,this.renderer=r.renderer,this.CLASS_NAME="OpenLayers.Layer.HTML"},OpenLayers.Layer.HTML.prototype=Object.create(OpenLayers.Layer.Grid.prototype),OpenLayers.Layer.HTML.prototype.setOpacity=function(e){if(e!==this.opacity){this.opacity=Math.max(Math.min(e,1),0);for(var t=this.div.childNodes,i=0,r=t.length;i<r;++i)t[i].style.opacity=this.opacity;null!==this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},t.exports=OpenLayers.Layer.HTML}()},{"./HtmlTile":12}],14:[function(e,t,i){!function(){"use strict";function i(e){r.call(this,e),this.zIndex=void 0!==e.zIndex?e.zIndex:749,this.domain="kml",this.source=e.source,this.id=e.id,this.kml=e.kml||[]}var r=e("./Layer"),n=e("../util/PubSub");i.prototype=Object.create(r.prototype),i.prototype.activate=function(){this.olLayers=[],this.kml.forEach(function(e){var t,i=e.units;switch("object"==typeof i&&(i=i[e.url.split("/").pop()]),i){case"meter":case"meters":case"metres":case"metre":case"m":t=new OpenLayers.Projection("EPSG:900913");break;case"degrees":case"degree":t=new OpenLayers.Projection("EPSG:4326");break;default:t=new OpenLayers.Projection("EPSG:4326")}e.olLayer=new OpenLayers.Layer.Vector("Vector Layer",{projection:t,strategies:[new OpenLayers.Strategy.Fixed],protocol:new OpenLayers.Protocol.HTTP({url:e.url,format:new OpenLayers.Format.KML({extractStyles:!0,extractAttributes:!0})})}),this.olLayers.push(e.olLayer)},this),this.setEnabled(this.isEnabled()),this.setOpacity(this.getOpacity()),this.setBrightness(this.getBrightness()),this.setContrast(this.getContrast()),n.publish(this.getChannel(),{field:"activate",value:!0}),this.olLayers.forEach(function(e){this.map.olMap.addLayer(e)},this),this.setZIndex(this.zIndex),n.publish(this.getChannel(),{field:"add",value:!0})},i.prototype.deactivate=function(){this.olLayers&&(this.olLayers.forEach(function(e){this.map.olMap.removeLayer(e),e.destroy(),e=null},this),n.publish(this.getChannel(),{field:"remove",value:!0}),this.kml.forEach(function(e){e.olLayer=null}),this.olLayers=[]),n.publish(this.getChannel(),{field:"deactivate",value:!0})},i.prototype.setZIndex=function(e){this.zIndex=e,this.olLayers&&this.olLayers.forEach(function(t,i){$(t.div).css("z-index",e+(this.olLayers.length-i))},this),n.publish(this.getChannel(),{field:"zIndex",value:e})},i.prototype.getZIndex=function(){return this.zIndex},i.prototype.setOpacity=function(e){this.opacity=e,this.olLayers&&this.olLayers.forEach(function(t){t.setOpacity(e)},this),n.publish(this.getChannel(),{field:"opacity",value:e})},i.prototype.setEnabled=function(e){this.enabled=e,this.olLayers&&this.olLayers.forEach(function(t){t.setVisibility(e)},this),n.publish(this.getChannel(),{field:"enabled",value:e})},i.prototype.setTileTransformRange=function(e){var t=e;t>=this.source.meta.meta.rangeMax?t=this.source.meta.meta.rangeMax:t<=this.source.meta.meta.rangeMin&&(t=this.source.meta.meta.rangeMin),t!==this.kmlDate&&(this.kmlDate=t,this.updateKMLData(!0))},i.prototype.setTileTransformData=function(){this.source.meta.meta.rangeMax!==this.kmlDate&&(this.kmlDate=this.source.meta.meta.rangeMax,this.updateKMLData(!0))},i.prototype.updateKMLData=function(e){var t=this,i=this.kmlDate;e&&this.deactivate(),this.kml.forEach(function(e,r){if(e.files){var n,a=null;e.files.forEach(function(e){(!a||Math.abs(e.date-i)<n)&&(n=Math.abs(e.date-i),a=e)}),t.name=t.source.name+" ("+moment(a.date).format("MMM YYYY")+")",a&&(e.url="rest/layers/"+t.id+"/kml/"+r+"/"+a.fileName)}}),e&&this.activate()},t.exports=i}()},{"../util/PubSub":59,"./Layer":15}],15:[function(e,t,i){!function(){"use strict";function i(e){e=e||{},this.uuid=r.generateUuid(),this.name=e.name||"Unnamed Layer",this.domain=e.domain,this.map=e.map,this.showPendingTiles=void 0===e.showPendingTiles||e.showPendingTiles,this.opacity=void 0!==e.opacity?e.opacity:1,this.brightness=void 0!==e.brightness?e.brightness:1,this.contrast=void 0!==e.brightness?e.brightness:1,this.enabled=void 0===e.enabled||e.enabled}var r=e("../util/Util"),n=e("../util/PubSub");i.prototype={setOpacity:function(e){this.opacity=e,this.olLayer&&this.olLayer.setOpacity(e),n.publish(this.getChannel(),{field:"opacity",value:e})},getOpacity:function(){return this.opacity},setBrightness:function(e){this.brightness=e,this.olLayer&&$(this.olLayer.div).css("-webkit-filter","brightness("+100*this.brightness+"%) contrast("+100*this.contrast+"%)"),n.publish(this.getChannel(),{field:"brightness",value:e})},getBrightness:function(){return this.brightness},setContrast:function(e){this.contrast=e,this.olLayer&&$(this.olLayer.div).css("-webkit-filter","brightness("+100*this.brightness+"%) contrast("+100*this.contrast+"%)"),n.publish(this.getChannel(),{field:"contrast",value:e})},getContrast:function(){return this.contrast},setEnabled:function(e){this.enabled=e,this.olLayer&&this.olLayer.setVisibility(e),n.publish(this.getChannel(),{field:"enabled",value:e})},isEnabled:function(){return this.enabled},getUUID:function(){return this.uuid},getChannel:function(){return"layer."+this.domain+"."+this.uuid}},t.exports=i}()},{"../util/PubSub":59,"../util/Util":60}],16:[function(e,t,i){!function(){"use strict";function e(e){var t;return"string"==typeof e?t=JSON.parse(e):e instanceof Array?1===e.length&&"string"==typeof e[0]?t=JSON.parse(e[0]):e.length>0&&void 0!==e[0].maximum||void 0!==e[0].minimum?(t=[],e.forEach(function(e){var i=void 0!==e.minimum?e.minimum:e.maximum;t.push(i)})):(t=[],e.forEach(function(e){t.push(e)})):t=e,t}function i(t){var i,r;try{return"string"==typeof t?JSON.parse(t):(t&&(r=e(t.maximum),i=e(t.minimum)),{maximum:r,minimum:i,bins:t.bins})}catch(n){return console.error("Error occured parsing layer meta data."),null}return console.error("Layer meta data format unrecognized."),null}function r(e){var t,r=e.meta;for(t in r)r.hasOwnProperty(t)&&"bucketCount"!==t&&"rangeMin"!==t&&"rangeMax"!==t&&"topicType"!==t&&"translatedTopics"!==t&&(r[t]=i(r[t]));return r}var n={parse:function(e){var t,i;if(!(e instanceof Array))return e.meta&&r(e.meta),e;for(t={},i=0;i<e.length;i++)e[i].meta&&r(e[i].meta),t[e[i].id]=e[i];return t},getTileIndex:function(e,t){var i=e.map.getResolution(),r=e.maxExtent,n=e.tileSize;return{xIndex:Math.round((t.left-r.left)/(i*n.w)),yIndex:Math.round((t.bottom-r.bottom)/(i*n.h)),level:e.map.getZoom()}},getTilekey:function(e,t){var i=n.getTileIndex(e,t),r=i.xIndex,a=i.yIndex,o=i.level;return o+","+r+","+a},getURL:function(e){var t=n.getTileIndex(this,e),i=t.xIndex,r=t.yIndex,a=t.level;if(i>=0&&r>=0)return this.url+this.layername+"/"+a+"/"+i+"/"+r+"."+this.type}};t.exports=n}()},{}],17:[function(e,t,i){!function(){"use strict";function i(e){return function(t){return e.map(function(e){return e.olLayer.getURL(t)})}}function r(e){n.call(this,e),this.getURL=i(e.source.layers)}var n=e("./ClientLayer"),a=e("../util/PubSub");r.prototype=Object.create(n.prototype),r.prototype.setLevelMinMax=function(){var e=this.map.getZoom(),t=this.renderer,i=this.source.layers.map(function(i){var r,n=i.source,a=n.meta&&n.meta.meta?n.meta.meta[e]:null,o=i.tileTransform.data||{},s=a;return a?t&&t.aggregator&&(r=t.aggregator.aggregate(a.bins||[],o.startBucket,o.endBucket),s=r instanceof Array?{minimum:r[r.length-1],maximum:r[0]}:{minimum:r,maximum:r}):s={minimum:null,maximum:null},s});this.levelMinMax=i,a.publish(this.getChannel(),{field:"levelMinMax",value:i})},t.exports=r}()},{"../util/PubSub":59,"./ClientLayer":9}],18:[function(e,t,i){!function(){"use strict";function i(e){return c.getTilekey(e.layer,e.bounds).replace(/,/g,"-")}function r(e){delete g[e],clearTimeout(f[e]),f[e]=setTimeout(function(){$(".olTilePending_"+e).css("opacity",0),delete f[e]},m)}function n(e){g[e]=0,f[e]&&(clearTimeout(f[e]),delete f[e]),$(".olTilePending_"+e).css("opacity",1)}function a(e,t){g[e]||n(e),g[e]++,v[t]=e}function o(e,t){g[e]&&(g[e]--,0===g[e]&&r(e),v[t]=null)}function s(e,t){var i=v[t];o(i,t),a(e,t)}function l(e){return function(t){e.olLayer&&"activate"===t.field&&e.olLayer.events.register("addtile",e.olLayer,function(e){e.tile.events.register("loadstart",e.tile,function(e){a(i(e.object),e.object.id)}),e.tile.events.register("loadend",e.tile,function(e){o(i(e.object),e.object.id)}),e.tile.events.register("loaderror",e.tile,function(e){o(i(e.object),e.object.id)}),e.tile.events.register("reload",e.tile,function(e){s(i(e.object),e.object.id)}),e.tile.events.register("unload",e.tile,function(e){var t=e.object.id;o(v[t],t)})})}}function h(e){u.call(this,e),this.zIndex=9999,this.domain="pending",this.source={},this.tileClass=p}var u=e("./Layer"),c=e("./LayerUtil"),p=e("./PendingTile"),d=e("./HtmlTileLayer"),y=e("../util/PubSub"),m=400,f={},g={},v={};h.prototype=Object.create(u.prototype),h.prototype.activate=function(){this.olLayer=new d("Pending Tile Layer",this.source.tms,{layername:this.source.id,type:"json",maxExtent:new OpenLayers.Bounds((-20037500),(-20037500),20037500,20037500),isBaseLayer:!1,getURL:null,tileClass:this.tileClass}),this.setEnabled(this.isEnabled()),y.publish(this.getChannel(),{field:"activate",value:!0}),this.map.olMap.addLayer(this.olLayer),this.setZIndex(this.zIndex),y.publish(this.getChannel(),{field:"add",value:!0})},h.prototype.deactivate=function(){this.olLayer&&(this.map.olMap.removeLayer(this.olLayer),y.publish(this.getChannel(),{field:"remove",value:!0}),this.olLayer.destroy(),this.olLayer=null),y.publish(this.getChannel(),{field:"deactivate",value:!0})},h.prototype.setZIndex=function(e){this.zIndex=e,this.olLayer&&$(this.olLayer.div).css("z-index",e),y.publish(this.getChannel(),{field:"zIndex",value:e})},h.prototype.getZIndex=function(){return this.zIndex},h.prototype.register=function(e){e.pendingFunc=l(e),y.subscribe(e.getChannel(),e.pendingFunc)},h.prototype.unregister=function(e){y.unsubscribe(e.getChannel(),e.pendingFunc),delete e.pendingFunc},t.exports=h}()},{"../util/PubSub":59,"./HtmlTileLayer":13,"./Layer":15,"./LayerUtil":16,"./PendingTile":19}],19:[function(e,t,i){!function(){"use strict";function i(){OpenLayers.Tile.apply(this,arguments)}var r=e("./LayerUtil");i.prototype=Object.create(OpenLayers.Tile.HTML.prototype),i.prototype.getURL=function(){return r.getTilekey(this.layer,this.bounds).replace(/,/g,"-")},i.prototype.setImgSrc=function(e){var t=this,i=this.imgDiv;e?(i.setAttribute("data-url",e),t.onImageLoad.apply(t)):(this.stopLoading(),this.imgDiv=null,i.parentNode&&i.parentNode.removeChild(i))},i.prototype.onImageLoad=function(){var e=this.imgDiv;this.stopLoading(),e&&(this.renderHtml(),this.events.triggerEvent("loadend"),this.isLoading=!1)},i.prototype.getImage=function(){return this.imgDiv||(this.imgDiv=document.createElement("div"),this.imgDiv.className="olTileHtml olTilePending",this.imgDiv.style.position="absolute"),this.imgDiv},i.prototype.renderHtml=function(){var e=this.imgDiv,t=e.getAttribute("data-url",t);e.className="olTileHtml olTilePending olTilePending_"+t,e.innerHTML='<div class="cssload-loader"><ul><li></li><li></li><li></li><li></li><li></li><li></li></ul></div>'},t.exports=i}()},{"./LayerUtil":16}],20:[function(e,t,i){!function(){"use strict";function i(e,t){u.getEncodedImage(e.source.id,{renderer:e.renderer},function(i){e.rampImageUrl=i,h.publish(e.getChannel(),{field:"rampImageUrl",value:i}),t&&t(i)})}function r(e){var t=e.map.getZoom(),i=e.renderer.coarseness,r=Math.max(t-(i-1),0),n=e.source.meta,a=n.meta[r],o=a?a:{minimum:null,maximum:null};e.levelMinMax=o,h.publish(e.getChannel(),{field:"levelMinMax",value:o})}function n(e){return function(){e.olLayer&&r(e)}}function a(e){var t=this,i=e.getURL||l.getURL;s.call(this,e),this.zIndex=void 0!==e.zIndex?parseInt(e.zIndex,10):1,e.renderer=e.renderer||{},this.renderer=e.renderer,this.renderer.coarseness=void 0!==e.renderer.coarseness?parseInt(e.renderer.coarseness,10):1,this.renderer.rangeMin=void 0!==e.renderer.rangeMin?parseInt(e.renderer.rangeMin,10):0,this.renderer.rangeMax=void 0!==e.renderer.rangeMax?parseInt(e.renderer.rangeMax,10):100,this.valueTransform=e.valueTransform||{},this.tileTransform=e.tileTransform||{},this.domain="server",this.source=e.source,this.getURL=function(e){return i.call(this,e)+t.getQueryParamString()}}var o=e("../util/Util"),s=e("./Layer"),l=e("./LayerUtil"),h=e("../util/PubSub"),u=e("../rest/LegendService");a.prototype=Object.create(s.prototype),a.prototype.activate=function(){this.zoomCallback=n(this),this.map.on("zoomend",this.zoomCallback),this.olLayer=new OpenLayers.Layer.TMS("Server Rendered Tile Layer",this.source.tms,{layername:this.source.id,type:"png",maxExtent:new OpenLayers.Bounds((-20037500),(-20037500),20037500,20037500),transparent:!0,isBaseLayer:!1,getURL:this.getURL}),this.setEnabled(this.isEnabled()),this.setTheme(this.map.getTheme()),this.setOpacity(this.getOpacity()),this.setBrightness(this.getBrightness()),this.setContrast(this.getContrast()),h.publish(this.getChannel(),{field:"activate",value:!0}),this.map.olMap.addLayer(this.olLayer),this.setZIndex(this.zIndex),h.publish(this.getChannel(),{field:"add",value:!0})},a.prototype.deactivate=function(){this.olLayer&&(this.map.olMap.removeLayer(this.olLayer),h.publish(this.getChannel(),{field:"remove",value:!0}),this.olLayer.destroy(),this.olLayer=null),this.map.off("zoomend",this.zoomCallback),this.zoomCallback=null,h.publish(this.getChannel(),{field:"deactivate",value:!0})},a.prototype.setTheme=function(e){var t=this;this.renderer.theme=e,i(t),this.redraw()},a.prototype.getTheme=function(){return this.renderer.theme},a.prototype.setZIndex=function(e){this.zIndex=e,this.olLayer&&$(this.olLayer.div).css("z-index",e),h.publish(this.getChannel(),{field:"zIndex",value:e})},a.prototype.getZIndex=function(){return this.zIndex},a.prototype.setRampType=function(e,t){this.renderer.ramp!==e&&(this.renderer.ramp=e,i(this,t),this.redraw(),h.publish(this.getChannel(),{field:"rampType",value:e}))},a.prototype.getRampType=function(){return this.renderer.ramp},a.prototype.getLevelMinMax=function(){var e=this.levelMinMax;if(this.valueTransform.layerMin&&this.valueTransform.layerMin)return{minimum:this.valueTransform.layerMin,maximum:this.valueTransform.layerMax};if(e.maximum instanceof Array){var t,i=this.tileTransform.data,r=void 0!==i.startBucket?i.startBucket:0,n=void 0!==i.endBucket?i.endBucket:e.maximum.length-1,a=0,o=0;for(t=r;t<=n;t++)a+=e.minimum[t]||0,o+=e.maximum[t]||0;return{minimum:a,maximum:o}}return this.levelMinMax},a.prototype.getRampImageUrl=function(){return this.rampImageUrl},a.prototype.setRangeMinPercentage=function(e){e=100*Math.max(Math.min(e,1),0),this.renderer.rangeMin!==e&&(this.renderer.rangeMin=e,this.redraw(),h.publish(this.getChannel(),{field:"rangeMin",value:e}))},a.prototype.getRangeMinPercentage=function(){return this.renderer.rangeMin/100},a.prototype.setRangeMaxPercentage=function(e){e=100*Math.max(Math.min(e,1),0),this.renderer.rangeMax!==e&&(this.renderer.rangeMax=e,this.redraw(),h.publish(this.getChannel(),{field:"rangeMax",value:e}))},a.prototype.getRangeMaxPercentage=function(){return this.renderer.rangeMax/100},a.prototype.setRangeMinValue=function(e){this.setRangeMinPercentage(o.normalizeValue(e,this.getLevelMinMax(),this.getValueTransformType()))},a.prototype.getRangeMinValue=function(){return o.denormalizeValue(this.getRangeMinPercentage(),this.getLevelMinMax(),this.getValueTransformType())},a.prototype.setRangeMaxValue=function(e){this.setRangeMaxPercentage(o.normalizeValue(e,this.getLevelMinMax(),this.getValueTransformType()))},a.prototype.getRangeMaxValue=function(){return o.denormalizeValue(this.getRangeMaxPercentage(),this.getLevelMinMax(),this.getValueTransformType())},a.prototype.setValueTransformType=function(e){this.valueTransform.type!==e&&(this.valueTransform.type=e,this.redraw(),h.publish(this.getChannel(),{field:"valueTransformType",value:e}))},a.prototype.getValueTransformType=function(){return this.valueTransform.type},a.prototype.setTileTransformType=function(e){this.tileTransform.type!==e&&(this.tileTransform.type=e,this.redraw(),h.publish(this.getChannel(),{field:"tileTransformType",value:e}))},a.prototype.getTileTransformType=function(){return this.tileTransform.type},a.prototype.setTileTransformRange=function(e,t){var i=this.source.meta.meta,r=i.rangeMin,n=i.rangeMax,a=i.bucketCount,o=(n-r)/a;e>n&&t<r&&this.setTileTransformData({startBucket:-1,endBucket:-1}),this.setTileTransformData({startBucket:Math.max(0,Math.floor((e-r)/o)),endBucket:Math.min(a-1,Math.floor((t-r)/o))})},a.prototype.setTileTransformData=function(e){_.isEqual(this.tileTransform.data,e)||(this.tileTransform.data=e,this.redraw(),h.publish(this.getChannel(),{field:"tileTransformData",value:e}))},a.prototype.getTileTransformData=function(){return this.tileTransform.data||{}},a.prototype.setCoarseness=function(e){this.renderer.coarseness!==e&&(this.renderer.coarseness=e,r(this),this.redraw(),h.publish(this.getChannel(),{field:"coarseness",value:e}))},a.prototype.getCoarseness=function(){return this.renderer.coarseness},a.prototype.setFilterParams=function(e){this.filterParams=e,this.redraw()},a.prototype.getFilterParams=function(){return this.filterParams?this.filterParams:null},a.prototype.getQueryParamString=function(){var e={renderer:this.renderer,tileTransform:this.tileTransform,valueTransform:this.valueTransform,filter:this.getFilterParams()};return o.encodeQueryParams(e)},a.prototype.redraw=function(){this.olLayer&&(r(this),this.olLayer.redraw(),this.olLayer.map&&this.olLayer.map.tileManager&&this.olLayer.map.tileManager.updateTimeout(this.olLayer.map,this.olLayer.map.tileManager.zoomDelay,!0))},t.exports=a}()},{"../rest/LegendService":49,"../util/PubSub":59,"../util/Util":60,"./Layer":15,"./LayerUtil":16}],21:[function(e,t,i){!function(){"use strict";function i(e,t){return e=e.clone(),"x"===t.dimension?(e.bottom=t.map.getMaxExtent().bottom,e.top=t.map.getMaxExtent().bottom+1):(e.left=t.map.getMaxExtent().left,e.right=t.map.getMaxExtent().left+1),e}var r=e("./HtmlTile");OpenLayers.Tile.Univariate=function(){OpenLayers.Tile.HTML.apply(this,arguments)},OpenLayers.Tile.Univariate.prototype=Object.create(r.prototype),OpenLayers.Tile.Univariate.prototype.shouldDraw=function(){var e=!1,t=i(this.layer.maxExtent,this.layer);if(t){var r=this.layer.map,n=r.getMaxExtent(),a=r.baseLayer.wrapDateLine&&i(n,this.layer);this.bounds.intersectsBounds(t,{inclusive:!1,worldBounds:a})&&(e=!0)}return e||this.layer.displayOutsideMaxExtent},OpenLayers.Tile.Univariate.prototype.getImage=function(){if(!this.imgDiv){this.imgDiv=document.createElement("div"),this.imgDiv.className="olTileUnivariate";var e=this.imgDiv.style;e.visibility="hidden",e.opacity=0,this.layer.opacity<1&&(e.filter="alpha(opacity="+100*this.layer.opacity+")"),e.position="absolute"}return this.imgDiv},OpenLayers.Tile.Univariate.prototype.positionTile=function(){var e=this.getTile().style,t=this.layer.getImageSize(this.bounds),i=1;this.layer instanceof OpenLayers.Layer.Grid&&(i=this.layer.getServerResolution()/this.layer.map.getResolution()),e.left=this.position.x+"px",e.top="-256px",e.width=Math.round(i*t.w)+"px",e.height=Math.round(i*t.h)+"px"},t.exports=OpenLayers.Tile.Univariate}()},{"./HtmlTile":12}],22:[function(e,t,i){!function(){"use strict";function i(e,t){return e=e.clone(),"x"===t.dimension?(e.bottom=t.map.getMaxExtent().bottom,e.top=t.map.getMaxExtent().bottom+1):(e.left=t.map.getMaxExtent().left,e.right=t.map.getMaxExtent().left+1),e}function r(e,t){var i=$(e.viewPortDiv),r=$(t.div),n=i.height();"x"===t.dimension?r.css("top",n):r.css("left",0),a(e,t)}function n(e,t){return function(){a(e,t)}}function a(e,t){var i=$(t.div).parent(),r=$(e.viewPortDiv),n=$(t.div),a=i.position(),o=r.height();"x"===t.dimension?(n.children().each(function(){$(this).css("top",-256)}),n.css("top",o-a.top)):(n.children().each(function(){$(this).css("left",0)}),n.css("left",-a.left))}var o=e("./UnivariateTile");OpenLayers.Layer.Univariate=function(e,t,i){OpenLayers.Layer.Grid.call(this,e,t,i),this.getURL=i.getURL,this.layername=i.layername,this.dimension=i.dimension||"x",this.type=i.type,this.tileClass=i.tileClass||o,this.html=i.html,this.renderer=i.renderer,this.CLASS_NAME="OpenLayers.Layer.Univariate"},OpenLayers.Layer.Univariate.prototype=Object.create(OpenLayers.Layer.Grid.prototype),OpenLayers.Layer.Univariate.prototype.setOpacity=function(e){if(e!==this.opacity){this.opacity=Math.max(Math.min(e,1),0);for(var t=this.div.childNodes,i=0,r=t.length;i<r;++i)t[i].style.opacity=this.opacity;null!==this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},OpenLayers.Layer.Univariate.prototype.setMap=function(e){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.onMapMove=n(e,this),e.events.register("move",e,this.onMapMove),r(e,this)},OpenLayers.Layer.Univariate.prototype.removeMap=function(e){OpenLayers.Layer.Grid.prototype.removeMap.apply(this,arguments),e.events.unregister("move",e,this.onMapMove),this.onMapMove=null},OpenLayers.Layer.Univariate.prototype.setVisibility=function(e){OpenLayers.Layer.Grid.prototype.setVisibility.apply(this,arguments),this.onMapMove&&e&&r(this.map,this)},OpenLayers.Layer.Univariate.prototype.getExtent=function(){return i(this.map.calculateBounds(),this)},OpenLayers.Layer.Univariate.prototype.redraw=function(){var e=!1;if(this.map){this.inRange=this.calculateInRange();var t=this.getExtent();if(t&&this.inRange&&this.visibility){var i=!0;this.moveTo(t,i,!1),this.events.triggerEvent("moveend",{zoomChanged:i}),e=!0,r(this.map,this)}}return e},OpenLayers.Layer.Univariate.prototype.moveTo=function(e,t,r){if(e||(e=this.map.getExtent()),null!==e){e=i(e,this);var n=!this.grid.length||t,a=this.getTilesBounds(),o=this.map.getResolution(),s=this.getServerResolution(o);if(this.singleTile)(n||!r&&!a.containsBounds(e))&&(t&&"resize"!==this.transitionEffect&&this.removeBackBuffer(),t&&"resize"!==this.transitionEffect||this.applyBackBuffer(s),this.initSingleTile(e));else{if(n=n||!a.intersectsBounds(e,{worldBounds:this.map.baseLayer.wrapDateLine&&i(this.map.getMaxExtent(),this)}),o!==s){if(e=this.map.calculateBounds(null,s),e=i(e,this),n){var l=s/o;this.transformDiv(l)}}else this.div.style.width="100%",this.div.style.height="100%",this.div.style.left="0%",this.div.style.top="0%";n?(t&&"resize"===this.transitionEffect&&this.applyBackBuffer(s),this.initGriddedTiles(e)):this.moveGriddedTiles()}}},OpenLayers.Layer.Univariate.prototype.moveGriddedTiles=function(){for(var e=this.buffer+1;;){var t=this.grid[0][0],i={x:t.position.x+this.map.layerContainerOriginPx.x,y:t.position.y+this.map.layerContainerOriginPx.y},r=this.getServerResolution()/this.map.getResolution(),n={w:Math.round(this.tileSize.w*r),h:Math.round(this.tileSize.h*r)};if("x"===this.dimension)if(i.x>-n.w*(e-1))this.shiftColumn(!0,n);else{if(!(i.x<-n.w*e))break;this.shiftColumn(!1,n)}else if(i.y>-n.h*(e-1))this.shiftRow(!0,n);else{if(!(i.y<-n.h*e))break;this.shiftRow(!1,n)}}},t.exports=OpenLayers.Layer.Univariate}()},{"./UnivariateTile":21}],23:[function(e,t,i){!function(){"use strict";function i(e){r.call(this,e),this.zIndex=e.zIndex||749,this.domain=e.domain||"vector",this.source=e.source,this.styleMap=e.styleMap,this.strategies=e.strategies,this.getData=e.getData,this.teardown=e.teardown,this.olFeatures=e.olFeatures||[],this.group=e.group||""}var r=e("./Layer"),n=e("../util/PubSub");i.prototype=Object.create(r.prototype),i.prototype.activate=function(){var e={};this.strategies&&(e.strategies=this.strategies),this.styleMap&&(e.styleMap=this.styleMap),this.olLayer=new OpenLayers.Layer.Vector("Vector Layer",e),this.setEnabled(this.isEnabled()),this.setOpacity(this.getOpacity()),this.setBrightness(this.getBrightness()),this.setContrast(this.getContrast()),this.setTheme(this.map.getTheme()),n.publish(this.getChannel(),{field:"activate",value:!0}),this.map.olMap.addLayer(this.olLayer),this.getData&&this.getData(this),this.olFeatures&&this.setFeatures(this.olFeatures),this.setZIndex(this.zIndex),n.publish(this.getChannel(),{field:"add",value:!0})},i.prototype.deactivate=function(){this.teardown&&this.teardown(),this.olLayer&&(this.olLayer.strategies&&this.olLayer.strategies.forEach(function(e){e.deactivate()}),this.olLayer.strategies=[],this.map.olMap.removeLayer(this.olLayer),n.publish(this.getChannel(),{field:"remove",value:!0}),this.olLayer.destroyFeatures(),this.olLayer.destroy(),this.olLayer=null),n.publish(this.getChannel(),{field:"deactivate",value:!0})},i.prototype.setFeatures=function(e){this.olLayer&&(this.olLayer.destroyFeatures(),this.olFeatures=e,this.olLayer.addFeatures(e))},i.prototype.setTheme=function(e){this.theme=e},i.prototype.getTheme=function(){return this.theme},i.prototype.setZIndex=function(e){this.zIndex=e,this.olLayer&&($(this.olLayer.div).css("z-index",e),n.publish(this.getChannel(),{field:"zIndex",value:e}))},i.prototype.getZIndex=function(){return this.zIndex},t.exports=i}()},{"../util/PubSub":59,"./Layer":15}],24:[function(e,t,i){!function(){"use strict";function i(e){e.rootKey=e.rootKey||"tile.values[0].value[0].communities",o.call(this,e),r(this.spec)}var r,n,a,o=e("./Renderer"),s=e("./RendererUtil");r=function(e){var t;if(e.text.themes)for(t=0;t<e.text.themes.length;t++)e.text.themes[t].injectTheme({selector:".node-label"})},n=function(e,t){var i,r;return i=$('<div class="node-label" style="font-size:'+t+'px; padding-left:5px; padding-right:5px;">'+e+"</div>"),$("body").append(i),r=i.outerWidth(),i.remove(),r},a=function(e){return e.replace(/(?:^|,|\s)\S/g,function(e){return e.toUpperCase()})},i.prototype=Object.create(o.prototype),i.prototype.render=function(e){var t,i,r,o,l,h,u,c,p,d,y,m,f,g,v=256,x=this.spec.text,L=this.parent.getLevelMinMax(),b=s.getAttributeValue(e,this.spec.rootKey),T=Math.pow(2,this.parent.map.getZoom()),M=v/T,I=void 0!==x.labelIndex?x.labelIndex:0,w="",C=[],E=[];for(y=L.maximum.communities[0].hierLevel,0===y?(u=L.minimum.communities[0].degree,c=L.maximum.communities[0].degree):(u=L.minimum.communities[0].numNodes,c=L.maximum.communities[0].numNodes),g=0;g<b.length;g++)t=b[g],o=t.metadata.split(","),0===t.degree||""===o[I]||C.length>=5||C.indexOf(t.parentID)!==-1||(C.push(t.parentID),E.push(t),m=t[x.xKey]%M*T,f=t[x.yKey]%M*T,l=a(o[I].toLowerCase()),i=0===y?t.degree:t.numNodes,r=s.getFontSize(i,u,c,{type:"log"}),p=s.transformValue(i,u,c,"log"),d=10*Math.round(100*p/10),h=n(l,r),h=Math.min(h,200),w+='<div class="node-label node-label-'+d+'" style="left:'+m+"px;bottom:"+f+"px;font-size:"+r+"px;line-height:"+r+"px;width:"+h+"px;margin-left:"+-h/2+"px;margin-top:"+-r/2+"px;height:"+r+"px;z-index:"+Math.floor(r)+';">'+l+"</div>");return{html:w,entries:E}},t.exports=i}()},{"./Renderer":29,"./RendererUtil":30}],25:[function(e,t,i){!function(){"use strict";function i(e){e.rootKey=e.rootKey||"tile.values[0].value[0].communities",e.node=e.node||{},e.node.xKey=e.node.xKey||"x",e.node.yKey=e.node.yKey||"y",e.node.radiusKey=e.node.radiusKey||"r",e.parentNode=e.parentNode||{},e.parentNode.xKey=e.parentNode.xKey||"parentX",e.parentNode.yKey=e.parentNode.yKey||"parentY",e.parentNode.radiusKey=e.parentNode.radiusKey||"parentR",e.criticalNode=e.criticalNode||{},e.criticalNode.flag=e.criticalNode.flag||"isPrimaryNode",n.call(this,e),r(this.spec)}var r,n=e("./Renderer"),a=e("./RendererUtil");r=function(e){var t;if(e.node.themes)for(t=0;t<e.node.themes.length;t++)e.node.themes[t].injectTheme({selector:".community-node"});if(e.criticalNode.themes)for(t=0;t<e.criticalNode.themes.length;t++)e.criticalNode.themes[t].injectTheme({
selector:".community-node.community-critical-node"});if(e.parentNode.themes)for(t=0;t<e.parentNode.themes.length;t++)e.parentNode.themes[t].injectTheme({selector:".community-parent-node"})},i.prototype=Object.create(n.prototype),i.prototype.render=function(e){var t,i,r,n,o,s,l,h,u,c,p,d=256,y=2,m=this.spec,f=a.getAttributeValue(e,m.rootKey),g=Math.pow(2,this.parent.map.getZoom()),v=d/g,x="",L=[];for(l=0;l<f.length;l++)i=f[l],L.push(i),h=i[m.node.xKey]%v*g,u=i[m.node.yKey]%v*g,r=i[m.node.radiusKey]*g,n=2*r,r<1||0===i.degree||(t=i[m.criticalNode.flag]?"community-node community-critical-node":"community-node",x+='<div class="'+t+'" style="height:'+n+"px;width:"+n+"px;border-radius:"+n+"px;left:"+(h-r-y)+"px;bottom:"+(u-r-y)+"px;border-width:"+y+'px;"></div>',i[m.criticalNode.flag]&&(c=i[m.parentNode.xKey]%v*g,p=i[m.parentNode.yKey]%v*g,o=i[m.parentNode.radiusKey]*g,s=2*o,x+='<div class="community-parent-node" style="height:'+s+"px;width:"+s+"px;border-radius:"+s+"px;left:"+(c-o-y)+"px;bottom:"+(p-o-y)+"px;border-width:"+y+'px;"></div>'));return{html:x,entries:L}},t.exports=i}()},{"./Renderer":29,"./RendererUtil":30}],26:[function(e,t,i){!function(){"use strict";function i(e){e.rootKey=e.rootKey||"tile.values",e.point=e.point||{},e.point.xKey=e.point.xKey||"x",e.point.yKey=e.point.yKey||"y",e.point.magnitude.min=e.point.magnitude.min||-1,e.point.magnitude.max=e.point.magnitude.max||-1,n.call(this,e),r(this.spec)}var r,n=e("./Renderer"),a=e("./RendererUtil"),o=e("../../map/MapUtil");r=function(e){var t;if(e.point.themes)for(t=0;t<e.point.themes.length;t++)e.point.themes[t].injectTheme({selector:".point-annotation-fill",parentSelector:".point-annotation-aggregate"});if(e.aggregate.themes)for(t=0;t<e.aggregate.themes.length;t++)e.aggregate.themes[t].injectTheme({selector:".point-annotation-border",parentSelector:".point-annotation-aggregate"})},i.prototype=Object.create(n.prototype),i.prototype.render=function(e){var t,i,r,n,s,l,h,u,c=this.spec,p=this.parent.map,d=a.getAttributeValue(e,c.rootKey),y=c.point,m=[],f={},g="";for(i=e.index.level+","+e.index.xIndex+","+e.index.yIndex,r=o.getTopLeftViewportPixelForTile(p,i),h=0;h<d.length;h++)if(l=d[h].value,0!==l.length){for(m.push(l),g+='<div class="point-annotation-aggregate">',u=0;u<l.length;u++)if(n=o.getViewportPixelFromCoord(p,l[u][y.xKey],l[u][y.yKey]),s={x:n.x-r.x,y:n.y-r.y},t=Math.floor(s.x)+","+Math.floor(s.y),!f[t]){f[t]=!0;var v="";if(c.point.magnitude.min>0&&c.point.magnitude.max>0&&l[u].data.magnitude){var x=(l[u].data.magnitude-c.point.magnitude.min)/(c.point.magnitude.max-c.point.magnitude.min)*100;v="-"+10*Math.ceil(x/10)}g+='<div class="point-annotation point-annotation-fill'+v+'" style="left:'+s.x+"px;top:"+s.y+'px;border-width: 2px;"',l[u].data.labels&&(g+=' title="'+l[u].data.labels+'"'),g+='></div><div class="point-annotation point-annotation-border" style="left:'+s.x+"px;top:"+s.y+'px;border-width: 2px"></div>'}g+="</div>"}return{html:g,entries:m}},t.exports=i}()},{"../../map/MapUtil":45,"./Renderer":29,"./RendererUtil":30}],27:[function(e,t,i){!function(){"use strict";function i(e){e.rootKey=e.rootKey||"tile.values",e.point=e.point||{},e.point.xKey=e.point.xKey||"x",e.point.yKey=e.point.yKey||"y",n.call(this,e),r(this.spec)}var r,n=e("./Renderer"),a=e("./RendererUtil"),o=e("../../map/MapUtil");r=function(e){var t;if(e.point.themes)for(t=0;t<e.point.themes.length;t++)e.point.themes[t].injectTheme({selector:".point-annotation"})},i.prototype=Object.create(n.prototype),i.prototype.render=function(e){var t,i,r,n,s,l,h,u,c=this.spec,p=this.parent.map,d=a.getAttributeValue(e,c.rootKey),y=c.point,m=[],f={},g="";for(i=e.index.level+","+e.index.xIndex+","+e.index.yIndex,r=o.getTopLeftViewportPixelForTile(p,i),h=0;h<d.length;h++)if(l=d[h].value,0!==l.length)for(u=0;u<l.length;u++)m.push(l[u]),n=o.getViewportPixelFromCoord(p,l[u][y.xKey],l[u][y.yKey]),s={x:n.x-r.x,y:n.y-r.y},t=Math.floor(s.x)+","+Math.floor(s.y),f[t]||(f[t]=!0,g+='<div class="point-annotation point-annotation-single" style="left:'+s.x+"px;top:"+s.y+'px;border-width: 2px"',l[u].data.labels&&(g+=' title="'+l[u].data.labels+'"'),g+="></div>");return{html:g,entries:m}},t.exports=i}()},{"../../map/MapUtil":45,"./Renderer":29,"./RendererUtil":30}],28:[function(e,t,i){!function(){"use strict";function i(e){var t=e.replace(/\s+/g,"").split(/[\(\)]/);return"rgb"===t[0]||"rgba"===t[0]?e:"#"===e[0]&&(4===e.length||7===e.length)}function r(e,t,i,r){var a=e.selector,o=void 0!==r?i.selector+"-"+r:i.selector,s=i.parentSelector,l="";return t["background-color"]&&(l+=a+" "+o+"{background-color:"+t["background-color"]+";}"),t.color&&(l+=a+" "+o+"{color:"+t.color+";}"),t.opacity&&(l+=a+" "+o+"{opacity:"+t.opacity+";}"),s?(t["background-color:hover"]&&(l+=a+" "+s+":hover "+o+" {background-color:"+t["background-color:hover"]+";}"),t["color:hover"]&&(l+=a+" "+s+":hover "+o+" {color:"+t["color:hover"]+";}"),t["opacity:hover"]&&(l+=a+" "+s+":hover "+o+" {opacity:"+t["opacity:hover"]+";}")):(t["background-color:hover"]&&(l+=a+" "+o+":hover {background-color:"+t["background-color:hover"]+";}"),t["color:hover"]&&(l+=a+" "+o+":hover {color:"+t["color:hover"]+";}"),t["opacity:hover"]&&(l+=a+" "+o+":hover {opacity:"+t["opacity:hover"]+";}")),t["text-shadow"]&&(l+=a+" "+o+"{"+n("text-shadow",t["text-shadow"])+";}"),t.border&&(l+=a+" "+o+"{"+n("border",t.border)+";}"),l}function n(e,t){return t?"text-shadow"===e?i(t)?"text-shadow:-1px -1px 0 "+t+", 1px -1px 0 "+t+",-1px  1px 0 "+t+", 1px  1px 0 "+t+", 1px  0   0 "+t+",-1px  0   0 "+t+", 0    1px 0 "+t+", 0   -1px 0 "+t:"text-shadow:"+t+";":"border"===e?i(t)?"border: 1px solid "+t:"border:"+t+";":"":""}function a(e,t){t=t||{},this.selector="light"===e?".light-theme":".dark-theme",this.spec=t}var o=e("./RendererUtil");a.prototype.injectTheme=function(e){var t,i,n,a,s;if(t='<style class="render-theme" type="text/css">',this.spec.from&&this.spec.to)for(n=this.spec.from,a=this.spec.to,s=10;s>=0;s--)i={},n["background-color"]&&a["background-color"]&&(i["background-color"]=o.hexBlend(a["background-color"],n["background-color"],s/10)),n.color&&a.color&&(i.color=o.hexBlend(a.color,n.color,s/10)),n.opacity&&a.opacity&&(i.opacity=n.opacity+(a.opacity-n.opacity)/10*s),n["background-color:hover"]&&a["background-color:hover"]&&(i["background-color:hover"]=o.hexBlend(a["background-color:hover"],n["background-color:hover"],s/10)),n["color:hover"]&&a["color:hover"]&&(i["color:hover"]=o.hexBlend(a["color:hover"],n["color:hover"],s/10)),n["opacity:hover"]&&a["opacity:hover"]&&(i["opacity:hover"]=n["opacity:hover"]+(a["opacity:hover"]-n["opacity:hover"])/10*s),n["text-shadow"]&&a["text-shadow"]&&(i["text-shadow"]=o.hexBlend(a["text-shadow"],n["text-shadow"],s/10)),n.border&&a.border&&(i.border=o.hexBlend(a.border,n.border,s/10)),t+=r(this,i,e,10*s),10===s&&(t+=r(this,i,e));else t+=r(this,this.spec,e);t+="</style>",$(document.head).prepend(t)},t.exports=a}()},{"./RendererUtil":30}],29:[function(e,t,i){!function(){"use strict";function i(e){this.spec=e||{},this.uuid=r.generateUuid(),e.aggregator&&(this.aggregator=e.aggregator)}var r=e("../../util/Util"),n=e("./RendererUtil");i.prototype.addHook=function(e){this.spec.hook&&(this.spec.hooks=[this.spec.hook],delete this.spec.hook),this.spec.hooks=this.spec.hooks||[],e&&"function"==typeof e&&this.spec.hooks.push(e)},i.prototype.removeHook=function(e){var t;this.spec.hook&&this.spec.hook===e&&(delete this.spec.hook,this.spec.hooks=[this.spec.hook]),this.spec.hooks&&(t=this.spec.hooks.indexOf(e),t!==-1&&this.spec.hooks.splice(t,1))},i.prototype.getEntrySelector=function(){return!1},i.prototype.select=function(e){var t,i,r=$(this.parent.olLayer.div).find(".olTileHtml,.olTileUnivariate"),a=this.spec.select.selectKey,o=this.getEntrySelector(),s=this.uuid;a&&(this.selectValue=t=n.getAttributeValue(e,a),i=o?r.find(o):r.children(),i.each(function(){var e,i,r=$(this);s===r.data("uuid")&&(e=r.data("entry"),i=n.getAttributeValue(e,a),i===t?r.removeClass("de-emphasized").addClass("emphasized"):r.removeClass("emphasized").addClass("de-emphasized"))}))},i.prototype.unselect=function(){var e,t=$(this.parent.olLayer.div).find(".olTileHtml,.olTileUnivariate"),i=this.getEntrySelector();e=i?t.find(i):t.children(),e.each(function(){$(this).removeClass("de-emphasized").removeClass("emphasized")}),this.selectValue=null},i.prototype.render=function(){return{html:"",entries:[]}},i.prototype.attach=function(e){return this.parent&&this.parent!==e?void console.log("This renderer has already been attached to a different layer, please use another instance."):(this.parent=e,void(this.aggregator&&this.aggregator.attach(e)))},i.prototype.injectEntries=function(e,t){var i,r=this.getEntrySelector(),a=$(e),o=this.selectValue,s=this.spec.select,l=this.uuid;s&&s.selectKey&&(i=s.selectKey,r&&(a=a.find(r)),a.each(function(e,r){var a=$(r),s=t[e],h=n.getAttributeValue(s,i);a.data("entry",s),a.data("uuid",l),o&&i&&(h===o?a.removeClass("de-emphasized").addClass("emphasized"):a.removeClass("emphasized").addClass("de-emphasized"))}))},i.prototype.executeHooks=function(e,t,i){function r(e,r){n(r,t[e],t,i)}var n,a,o,s=this.spec.hook?[this.spec.hook]:this.spec.hooks,l=this.getEntrySelector();if(s)for(o=0;o<s.length;o++)n=s[o],"function"==typeof n&&(a=$(e),l&&(a=a.find(l)),a.each(r))},t.exports=i}()},{"../../util/Util":60,"./RendererUtil":30}],30:[function(e,t,i){!function(){"use strict";function e(e){return Math.log(e)/Math.LN10}t.exports={getYOffset:function(e,t,i){return i-(e-1)/2*t},transformValue:function(t,i,r,n){var a=Math.max(Math.min(t,r),i);if("log"===n){var o=e(i||1),s=e(r||1),l=1/(s-o||1);return(e(a||1)-o)*l}var h=r-i;return(a-i)/h},getFontSize:function(e,t,i,r){r=r||{};var n=r.maxFontSize||22,a=r.minFontSize||12,o=this.transformValue(e,t,i,r.type);return a+o*(n-a)},getAttributeValue:function(e,t){var i,r,n,a;for("function"==typeof t&&(t=t(e)),i=t.split("."),n=e,a=0;a<i.length;a++)r=i[a].replace(/ /g,"").split(/[\[\]]/),1===r.length?i[a].length>0&&(n=n[i[a]]):n=3===r.length?n[r[0]][r[1]]:n[r[0]];return n},hexToRgb:function(e){var t;return e=e.replace(/#/,""),3===e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=parseInt(e,16),{r:t>>16&255,g:t>>8&255,b:255&t}},rgbToHex:function(e){function t(e){var t=e.toString(16);return 1===t.length?"0"+t:t}var i=e.r,r=e.g,n=e.b;return"#"+t(Math.floor(i))+t(Math.floor(r))+t(Math.floor(n))},hexBrightness:function(e,t){var i=this.hexToRgb(e);return this.rgbToHex({r:Math.min(Math.max(0,i.r*t),255),g:Math.min(Math.max(0,i.g*t),255),b:Math.min(Math.max(0,i.b*t),255)})},hexGreyscale:function(e){var t=this.hexToRgb(e),i=.21*t.r+.72*t.g+.07*t.b;return this.rgbToHex({r:i,g:i,b:i})},hexBlend:function(e,t,i){var r=void 0!==i?Math.min(1,i):.5,n=1-r,a=this.hexToRgb(e),o=this.hexToRgb(t);return this.rgbToHex({r:a.r*r+o.r*n,g:a.g*r+o.g*n,b:a.b*r+o.b*n})}}}()},{}],31:[function(e,t,i){!function(){"use strict";function i(e){e.rootKey=e.rootKey||"tile.meta.aggregated",e.frequency.invertOrder=e.frequency.invertOrder||!1,a.call(this,e),this.injectCss(this.spec)}var r,n,a=e("./Renderer"),o=e("./RendererUtil"),s=8;r=function(e,t,i){return 118-((t-1)/2-e)*i},n=function(e,t){var i,r=0,n=o.getAttributeValue(e,t);for(i=0;i<n.length;i++)r=Math.max(r,n[i]);return r},i.prototype=Object.create(a.prototype),i.prototype.getEntrySelector=function(){return".text-by-frequency-label"},i.prototype.injectCss=function(e){var t;if(e.text.themes)for(t=0;t<e.text.themes.length;t++)e.text.themes[t].injectTheme({selector:".text-by-frequency-label",parentSelector:".text-by-frequency-entry"});if(e.frequency.themes)for(t=0;t<e.frequency.themes.length;t++)e.frequency.themes[t].injectTheme({selector:".text-by-frequency-bar",parentSelector:".text-by-frequency-entry"})},i.prototype.getBarStyleClass=function(e,t,i){var r=10*Math.round(i/10);return"text-by-frequency-bar text-by-frequency-bar-"+r},i.prototype.getTextStyleClass=function(){return"text-by-frequency-label"},i.prototype.render=function(e){var t,i,a,l,h,u,c,p,d,y=this,m=14,f=24,g=20,v=this.spec.text.textKey,x=this.spec.frequency,L=x.countKey,b=x.invertOrder,T=o.getAttributeValue(e,this.spec.rootKey),M=Math.min(T.length,s),I=this.parent.getLevelMinMax(),w=$("<div></div>"),C=[],E=0,O=0,A=0,k=0,P=$('<div class="count-summary"></div>');return w=w.append(P),I.maximum?O=n(I.maximum,L):T.forEach(function(e){O=Math.max(O,o.getAttributeValue(e,L))}),T=T.slice(0,M),T.forEach(function(e){C.push(e),l=o.getAttributeValue(e,L),i=o.getAttributeValue(e,v),u=l.length,a=n(e,L),d=o.getFontSize(a,E,O,{minFontSize:m,maxFontSize:f,type:"log"});var s="";s+='<div class="text-by-frequency-entry" style="top:'+(r(A,M,g)+(f-d))+"px;height:"+d+'px"></div>';var x=$(s);x.mouseover(function(){P.show(),P.text(e.count)}),x.mouseout(function(){P.hide()});var T=$('<div class="text-by-frequency-left"></div>');l.forEach(function(i,r){p=b?u-k-1:k,h=i/a*100,c=h>0?"":"hidden",t=y.getBarStyleClass(e,r,h),h=Math.max(h,20);var n="";n+='<div class="'+t+'" style="visibility:'+c+";height:"+h+"%;width:"+Math.floor((105+u)/u)+"px;top:"+(100-h)+'%;"></div>';var o=$(n);T.append(o),k+=1}),x.append(T);var I=$('<div class="text-by-frequency-right"></div>'),R="";R+='<div class="'+y.getTextStyleClass(e)+'" style="font-size:'+d+"px;line-height:"+d+"px;height:"+d+'px">'+i+"</div>";var B=$(R);I.append(B),x.append(I),w.append(x),A+=1}),{html:w,entries:C}},t.exports=i}()},{"./Renderer":29,"./RendererUtil":30}],32:[function(e,t,i){!function(){"use strict";function i(e){e.rootKey=e.rootKey||"tile.meta.raw",e.text=e.text||{},a.call(this,e),n(this.spec)}var r,n,a=e("./Renderer");n=function(e){var t,i;if(e.text.themes)for(t=0;t<e.text.themes.length;t++){var r=e.text.themes[t];for(i=0;i<r.length;i++)r[i].injectTheme({selector:".text-topic-"+t+"-label"})}},r=function(e,t){for(var i=[],r=0;r<t;r++)i[r]=[];return e.forEach(function(e){i[e.topicNumber].push(e.topic)}),i},i.prototype=Object.create(a.prototype),i.prototype.getEntrySelector=function(){return".text-by-topic-label"},i.prototype.render=function(e){for(var t,i,n=this.spec.text,a=n.textKey,o=n.numTopics?n.numTopics:3,s=e.tile.meta.raw[0],l=$('<div class="text-by-topic-box"></div>'),h=[],u=1;null===s&&u<e.tile.meta.raw.length;)s=e.tile.meta.raw[u],u++;for(h=r(s,o,a),t=0;t<o;t++){var c=h[t],p="";for(i=0;i<c.length;i++)p+=c[i]+" ";var d=$('<div class="text-topic-'+t+'-label text-topic-label">'+p+"</div>");l=l.append(d)}return{html:l,entries:s}},t.exports=i}()},{"./Renderer":29}],33:[function(e,t,i){!function(){"use strict";function i(e){e.rootKey=e.rootKey||"tile.meta.aggregated",n.call(this,e),r(this.spec)}var r,n=e("./Renderer"),a=e("./RendererUtil"),o=5,s=110;r=function(e){var t,i;if(e.text.themes){for(t=0;t<e.text.themes.length;t++)e.text.themes[t].injectTheme({selector:".text-score-label",parentSelector:".text-score-entry"}),e.text.themes[t].injectTheme({selector:".text-score-entry-count",parentSelector:".text-score-entry"});for(t=0;t<e.weights.length;t++)for(i=0;i<e.weights[t].themes.length;i++)e.weights[t].themes[i].injectTheme({selector:".text-score-weight-"+t,parentSelector:".text-score-entry"})}},i.prototype=Object.create(n.prototype),i.prototype.getEntrySelector=function(){return".text-score-entry"},i.prototype.render=function(e){var t,i,r,n,l,h,u,c,p,d,y,m,f,g,v,x=30,L=6,b=x-L-2,T=this.spec,M=T.weights,I=T.threshold||5,w=T.text.textKey,C=T.text.countKey,E=a.getAttributeValue(e,T.rootKey),O=this.parent.getLevelMinMax(),A=Math.min(E.length,o),k=13,P=18,R=Number.MAX_VALUE,B=0,U=[],$="";for(p=a.getYOffset(A,x+L,122),O.minimum?R=a.getAttributeValue(O.minimum,C):E.forEach(function(e){R=Math.min(R,a.getAttributeValue(e,C))}),O.maximum?B=a.getAttributeValue(O.maximum,C):E.forEach(function(e){B=Math.max(B,a.getAttributeValue(e,C))}),g=0;g<A;g++){if(d=E[g],U.push(d),y=a.getAttributeValue(d,w),m=a.getAttributeValue(d,C),t=m<I?"de-saturate":"",f=a.getFontSize(m,R,B,{minFontSize:k,maxFontSize:P,type:"log"}),h=(f-k)/(P-k),$+='<div class="text-score-entry-parent" style="top:'+p+'px;">',$+='<div class="text-score-entry" style="height:'+x+'px;">',$+='<div class="text-score-entry-count">'+m+"</div>",i=10*Math.round(100*h/10),$+='<div class="text-score-label text-score-label-'+i+" "+t+'" style="font-size:'+f+"px;line-height:"+f+"px;bottom:"+-(b-f)+'px;">'+y+"</div>",m>0){for(l=[],v=0;v<M.length;v++)u=a.getAttributeValue(d,M[v].weightKey),l.push(u);for(r=Math.floor((M.length-1)/2),n=M.length%2===0?l[r]:l[r]/2,v=r-1;v>=0;v--)n+=l[v];for(c=s,$+='<div class="text-score-weight-bar" style="width:'+c+"px;height:"+L+"px;left:"+-c*(n/m)+'px;">',v=0;v<M.length;v++)$+='<div class="text-score-weight text-score-weight-'+v+" "+t+'" style="width:'+l[v]/m*100+'%;"></div>';$+="</div>"}$+="</div>",$+="</div>",$+='<div class="clear"></div>'}return{html:$,entries:U}},t.exports=i}()},{"./Renderer":29,"./RendererUtil":30}],34:[function(e,t,i){!function(){"use strict";function i(e){e.rootKey=e.rootKey||"tile.meta.aggregated",e.text=e.text||{},h.call(this,e),this.injectCss(this.spec)}var r,n,a,o,s,l,h=e("./Renderer"),u=e("./RendererUtil"),c=10,p=10,d=24,y="log",m=13,f=28;r=function(e){var t=2*Math.PI,i=t*e.radius,r=e.arcLength>i/10?i/10:e.arcLength,n=r/e.radius,a=e.t+n;return a>t&&(a%=t,e.radius=e.radius+e.radiusInc),e.t=a,e.x=e.radius*Math.cos(a),e.y=e.radius*Math.sin(a),e},n=function(e,t){return 2*Math.abs(e.x-t.x)<e.width+t.width&&2*Math.abs(e.y-t.y)<e.height+t.height},a=function(e,t){return e.x+e.width/2>t.x+t.width/2||e.x-e.width/2<t.x-t.width/2||e.y+e.height/2>t.y+t.height/2||e.y-e.height/2<t.y-t.height/2},o=function(e,t,i,r){var o,s={x:e.x,y:e.y,height:t.height,width:t.width};for(o=0;o<i.length;o++)if(n(s,i[o]))return!0;return!!a(s,r)&&(e.collisions++,e.arcLength=e.radius,!0)},s=function(e,t){var i,r={};return i=$('<div class="word-cloud-label-temp" style="font-size:'+t+'px;">'+e+"</div>"),$("body").append(i),r.width=i.outerWidth(),r.height=i.outerHeight(),i.remove(),r},l=function(e,t,i,n,a,l){var h,c,y,m,f,g,v,x={width:256-2*p,height:256-2*d,x:0,y:0},L=[];for(e.sort(function(e,t){return t.count-e.count}),c=0;c<e.length;c++){y=e[c].word,m=e[c].count,g=u.getFontSize(m,t,i,{maxFontSize:l,minFontSize:a,type:n}),h=(g-a)/(l-a)*100,f=s(y,g),v={radius:1,radiusInc:5,arcLength:5,x:0,y:0,t:0,collisions:0};for(var b=e.length;v.collisions<b;)if(v=r(v),!o(v,f,L,x)){L.push({word:y,entry:e[c].entry,fontSize:g,percentLabel:10*Math.round(h/10),x:v.x,y:v.y,width:f.width,height:f.height});break}}return L},i.prototype=Object.create(h.prototype),i.prototype.getEntrySelector=function(){return".word-cloud-label"},i.prototype.injectCss=function(e){var t;if(e.text.themes)for(t=0;t<e.text.themes.length;t++)e.text.themes[t].injectTheme({selector:".word-cloud-label"}),e.text.themes[t].injectTheme({selector:".count-summary"})},i.prototype.getWordStyleClass=function(e){return"word-cloud-label word-cloud-label-"+e.percentLabel},i.prototype.render=function(e){var t,i,r,n,a,o=this,s=this.spec.text,h=s.textKey,p=s.countKey,d=u.getAttributeValue(e,this.spec.rootKey),g=Math.min(d.length,s.maxWords||c),v=this.parent.getLevelMinMax(),x=s.sizeFunction||y,L=s.minFontSize||m,b=s.maxFontSize||f,T=Number.MAX_VALUE,M=0,I=$("<div></div>"),w=[],C=[];for(n=0;n<g;n++)t=d[n],i=u.getAttributeValue(t,h),r=u.getAttributeValue(t,p),T=Math.min(T,r),M=Math.max(M,r),w.push({word:i,count:r,entry:t});v.minimum&&(T=u.getAttributeValue(v.minimum,p)),v.maximum&&(M=u.getAttributeValue(v.maximum,p)),a=l(w,T,M,x,L,b);var E=$('<div class="count-summary"></div>');return I=I.append(E),a.forEach(function(e){C.push(e.entry);var t=$('<div class="'+o.getWordStyleClass(e)+'" style="font-size:'+e.fontSize+"px;left:"+(128+e.x-e.width/2)+"px;top:"+(128+e.y-e.height/2)+"px;width:"+e.width+"px;height:"+e.height+'px;">'+e.word+"</div>");t.mouseover(function(){E.show(),E.text(u.getAttributeValue(e.entry,p))}),t.mouseout(function(){E.hide()}),I=I.append(t)}),{html:I,entries:C}},t.exports=i}()},{"./Renderer":29,"./RendererUtil":30}],35:[function(e,t,i){!function(){"use strict";function e(){}e.prototype.aggregate=function(e){return e},e.prototype.attach=function(e){return this.parent&&this.parent!==e?void console.log("This renderer has already been attached to a different layer, please use another instance."):void(this.parent=e)},e.prototype.getBucketRange=function(e){var t=this.parent.getTileTransformData(),i=t.startBucket,r=t.endBucket;return{start:void 0!==i?i:0,end:void 0!==r?r:e.length-1}},e.prototype.translateTopic=function(e){var t=this.parent.source.meta.meta;if(t.translatedTopics)return t.translatedTopics[e]},e.prototype.forEach=function(e,t){var i,r=this.getBucketRange(e),n=r.start,a=r.end;for(i=n;i<=a;i++)if(t(e[i],i-n))return},t.exports=e}()},{}],36:[function(e,t,i){!function(){"use strict";function i(){}var r=e("./Aggregator"),n=e("../../../util/Util");i.prototype=Object.create(r.prototype),i.prototype.aggregate=function(e){var t={},i=this.getBucketRange(e),r=i.end-i.start+1;return this.forEach(e,function(e,i){var a,o;if(e)for(o=0;o<e.length;o++)a=e[o].topic,t[a]=t[a]||n.fillArray(r),t[a][i]=e[o].score.total}),t},t.exports=i}()},{"../../../util/Util":60,"./Aggregator":35}],37:[function(e,t,i){!function(){"use strict";function i(){}var r=e("./Aggregator"),n=e("../../../util/Util");i.prototype=Object.create(r.prototype),i.prototype.aggregate=function(e){var t,i={},r=this.getBucketRange(e),a=r.end-r.start+1;return this.forEach(e,function(e,r){var o,s;if(e)for(s=0;s<e.length;s++)o=e[s].topic,t=e[s].score.total.length,i[o]=i[o]||n.fillArray(a,n.fillArray(t)),i[o][r]=e[s].score.total.slice(0)}),i},t.exports=i}()},{"../../../util/Util":60,"./Aggregator":35}],38:[function(e,t,i){!function(){"use strict";function i(e,t){var i,r,n,a;for(i={topic:t[0].topic,topicEnglish:e.translateTopic(t[0].topic),count:0},a=0;a<t.length;a++)r=t[a].score,void 0!==r&&(n="number"==typeof r?r:r.total,i.count+=n);return i}function r(){}var n=e("./Aggregator");r.prototype=Object.create(n.prototype),r.prototype.aggregate=function(e){var t,r={},n=[];this.forEach(e,function(e){var t,i;if(e)for(i=0;i<e.length;i++)t=e[i].topic,r[t]=r[t]||[],r[t].push(e[i])});for(t in r)r.hasOwnProperty(t)&&n.push(i(this,r[t]));return n.sort(function(e,t){return t.count-e.count}),n},t.exports=r}()},{"./Aggregator":35}],39:[function(e,t,i){!function(){"use strict";function i(e,t){var i,r,a,s,l,h,u,c;for(i={topic:t[0].topic,topicEnglish:e.translateTopic(t[0].topic),counts:o.fillArray(t[0].score instanceof Array?t[0].score.length:t[0].score.total.length),total:0},h=0;h<t.length;h++){for(r=t[h].score,a=r instanceof Array?r:r.total,u=0;u<a.length;u++)i.counts[u]+=a[u],i.total+=a[u];if(s=r.texts)for(c=0;c<s.length;c++)l=JSON.parse(s[c].text),i.sentiment=n(l[2])}return i}function r(){}function n(e){if(void 0!==e)return e===-1?"negative":1===e?"positive":"neutral"}var a=e("./Aggregator"),o=e("../../../util/Util");r.prototype=Object.create(a.prototype),r.prototype.aggregate=function(e){var t,r={},n=[];this.forEach(e,function(e){var t,i;if(e)for(i=0;i<e.length;i++)t=e[i].topic,r[t]=r[t]||[],r[t].push(e[i])});for(t in r)r.hasOwnProperty(t)&&n.push(i(this,r[t]));return n.sort(function(e,t){return t.total-e.total}),n},t.exports=r}()},{"../../../util/Util":60,"./Aggregator":35}],40:[function(e,t,i){!function(){"use strict";function i(){}var r=e("./Aggregator"),n=e("../../../util/Util");i.prototype=Object.create(r.prototype),i.prototype.aggregate=function(e){var t=this,i={},r=this.getBucketRange(e),a=r.end-r.start+1,o=[];return this.forEach(e,function(e,r){var s,l,h,u,c,p,d;if(e)for(c=0;c<e.length;c++){if(l=e[c].topic,void 0===i[l]&&(i[l]=o.length,o.push({topic:l,topicEnglish:t.translateTopic(l),count:0,frequencies:n.fillArray(a)})),h=e[c].score,u="number"==typeof h||h instanceof Array?h:h.total,s=i[l],u instanceof Array){o[s].indexedCount||(o[s].indexedCount=new Array(u.length).fill(0),o[s].indexedFrequencies=new Array(a)),o[s].indexedFrequencies[r]||(o[s].indexedFrequencies[r]=new Array(u.length).fill(0));var y=0;for(p=0;p<u.length;p++)d=u[p],y+=d,o[s].indexedCount[p]+=d,o[s].indexedFrequencies[r][p]+=d;u=y}o[s].count+=u,o[s].frequencies[r]=u}}),o.sort(function(e,t){return t.count-e.count}),o},t.exports=i}()},{"../../../util/Util":60,"./Aggregator":35}],41:[function(e,t,i){!function(){"use strict";function i(e){if(void 0!==e)return e===-1?"negative":1===e?"positive":"neutral"}function r(e){var t,r,n,a,o,s=[];for(a=0;a<e.length;a++)for(n=e[a],r=n.score.texts,o=0;o<r.length;o++)t=JSON.parse(r[o].text),s.push({user:t[0],text:t[1],sentiment:i(t[2]),timestamp:r[o].score});return s}function n(){}var a=e("./Aggregator");n.prototype=Object.create(a.prototype),n.prototype.aggregate=function(e){var t,i={},n={};this.forEach(e,function(e){var t,r;if(e)for(r=0;r<e.length;r++)t=e[r].topic,i[t]=i[t]||[],i[t].push(e[r])});for(t in i)i.hasOwnProperty(t)&&(n[t]=r(i[t]));return n},t.exports=n}()},{"./Aggregator":35}],42:[function(e,t,i){!function(){"use strict";function i(e,t){return'<div class="'+R+" "+e.horizontalOrVertical+B+'"style="position:absolute;">'+e.format(t.label)+"</div>"}function r(e,t){var i,r;return e.isXAxis?(i=t.pixel-.5*e.MAX_LABEL_UNROTATED_WIDTH,r=e.LARGE_MARKER_LENGTH+H):(i=t.pixel-.5*e.MAX_LABEL_HEIGHT,r=e.LARGE_MARKER_LENGTH+H),'<div class="'+R+" "+e.horizontalOrVertical+B+'"style="position:absolute;text-align: center; height: '+e.MAX_LABEL_HEIGHT+"px;line-height: "+e.MAX_LABEL_HEIGHT+"px;"+e.leftOrTop+":"+i+"px;"+e.oppositePosition+":"+r+'px;">'+e.format(t.label)+"</div>"}function n(e,t){return'<div class="'+U+" large-"+e.horizontalOrVertical+S+" "+e.position+z+'"style="position:absolute;'+e.leftOrTop+":"+(t.pixel-e.LARGE_MARKER_HALF_WIDTH)+'px;"></div>'}function a(e,t){return'<div class="'+U+" medium-"+e.horizontalOrVertical+S+" "+e.position+z+'"style="position:absolute;'+e.leftOrTop+":"+(t.pixel-e.MEDIUM_MARKER_HALF_WIDTH)+'px;"></div>'}function o(e,t){return'<div class="'+U+" small-"+e.horizontalOrVertical+S+" "+e.position+z+'"style="position:absolute;'+e.leftOrTop+":"+(t.pixel-e.SMALL_MARKER_HALF_WIDTH)+'px;"></div>'}function s(e,t){var i,r,n;i=t.css("-webkit-transform")||t.css("-moz-transform")||t.css("-ms-transform")||t.css("-o-transform")||t.css("transform")||"none","none"!==i?(r=i.split("(")[1].split(")")[0].split(","),n=Math.atan2(r[1],r[0])):n=0,e.ROTATION_RADIANS=Math.abs(n)}function l(e,t){var i=t.width()*Math.sin(e.ROTATION_RADIANS),r=t.height()*Math.sin(e.ROTATION_RADIANS),n=t.width()*Math.cos(e.ROTATION_RADIANS),a=t.height()*Math.cos(e.ROTATION_RADIANS);e.MAX_LABEL_WIDTH=Math.max(r+n,e.MAX_LABEL_WIDTH),e.MAX_LABEL_HEIGHT=Math.max(a+i,e.MAX_LABEL_HEIGHT),e.MAX_LABEL_UNROTATED_WIDTH=Math.max(t.width(),e.MAX_LABEL_UNROTATED_WIDTH)}function h(e){var t,r={pixel:0,label:e.min},n={pixel:0,label:e.max};e.MAX_LABEL_WIDTH=0,e.MAX_LABEL_HEIGHT=0,e.MAX_LABEL_UNROTATED_WIDTH=0,t=$(i(e,n)).appendTo(e.$content),l(e,t),t.remove(),t=$(i(e,r)).appendTo(e.$content),l(e,t),t.remove()}function u(e){var t;if(e.LARGE_MARKER_LENGTH=0,e.LARGE_MARKER_HALF_WIDTH=0,e.MEDIUM_MARKER_HALF_WIDTH=0,e.SMALL_MARKER_HALF_WIDTH=0,e.ROTATION_RADIANS=0,e.HEADER_WIDTH=0,e.TITLE_WIDTH=0,e.title)switch(e.TITLE_WIDTH=e.$title.width(),e.position){case"top":e.HEADER_WIDTH=parseInt(e.$header.css("border-top-width"),10);break;case"right":e.HEADER_WIDTH=parseInt(e.$header.css("border-right-width"),10);break;case"bottom":e.HEADER_WIDTH=parseInt(e.$header.css("border-bottom-width"),10);break;case"left":e.HEADER_WIDTH=parseInt(e.$header.css("border-left-width"),10)}t=$(n(e,{pixel:0})).hide().appendTo(e.$content),e.LARGE_MARKER_LENGTH=t[e.markerWidthOrHeight](),e.LARGE_MARKER_HALF_WIDTH=Math.floor(.5*t[e.axisWidthOrHeight]()),t.remove(),t=$(a(e,{pixel:0})).hide().appendTo(e.$content),e.MEDIUM_MARKER_HALF_WIDTH=Math.floor(.5*t[e.axisWidthOrHeight]()),t.remove(),t=$(o(e,{pixel:0})).hide().appendTo(e.$content),e.SMALL_MARKER_HALF_WIDTH=Math.floor(.5*t[e.axisWidthOrHeight]()),t.remove(),t=$(i(e,{pixel:0})).appendTo(e.$content),s(e,t),t.remove(),h(e)}function c(e){var t="",i="";return e.isXAxis||(t="rotate(-90deg)",i="top left"),$('<span class="'+C+'"style="position:absolute;-webkit-transform: '+t+";-moz-transform: "+t+";-ms-transform: "+t+";-o-transform: "+t+";transform: "+t+";-webkit-transform-origin: "+i+";-moz-transform-origin: "+i+";-ms-transform-origin: "+i+";-o-transform-origin: "+i+";transform-origin: "+i+';">'+e.title+"</div>")}function p(e){return $('<div class="'+O+" "+e.horizontalOrVertical+"-header "+e.position+A+'"style="z-index:'+(D+2)+';"></div>')}function d(e){return $('<div class="'+O+" "+O+"-back "+e.horizontalOrVertical+'-header-back"style="z-index:'+(D+1)+";"+e.position+":0px;"+(e.isXAxis?"":"top:0px;")+'"></div>')}function y(e){return $('<div class="'+k+" "+e.position+P+'"  style="z-index:'+D+';"></div>')}function m(e){var t,i,r,n,a;return i=function(){e.isXAxis?(e.$header.click(a),e.$content.click(a)):(e.$header.click(n),e.$content.click(n))},r=function(){e.$header.off("click"),e.$content.off("click")},n=function(){e.setEnabled(!e.isEnabled()),e.updateDimension(),r(),e.$content.animate({width:"toggle"},{duration:300,complete:function(){i()}}),e.redraw(),I.publish(e.getChannel(),{field:"open",value:e.isEnabled()})},a=function(){e.setEnabled(!e.isEnabled()),e.updateDimension(),r(),e.$content.animate({height:"toggle"},{duration:300,complete:function(){i()}}),e.redraw(),I.publish(e.getChannel(),{field:"open",value:e.isEnabled()})},e.$content=y(e),t=$('<div class="axis '+e.position+E+'"></div>'),t.append(e.$content),e.title&&(e.$title=c(e),e.$header=p(e).append(e.$title),t.append(e.$header),t.append(d(e)),e.collapsible&&i()),t}function f(e){var t,i,r=e.$title;e.isXAxis?t=e.$map.outerWidth():(t=e.$map.outerHeight()-2*e.HEADER_WIDTH,r.css(e.leftOrTop,t+"px")),i=t/2-e.TITLE_WIDTH/2,r.css("padding-left",i+"px")}function g(e){var t,i,s,l="";for(i=w.getMarkers(e),t=i.large,s=0;s<t.length;s++)l+=n(e,t[s]),t[s].label&&(l+=r(e,t[s]));for(t=i.medium,s=0;s<t.length;s++)l+=a(e,t[s]),t[s].label&&(l+=r(e,t[s]));for(t=i.small,s=0;s<t.length;s++)l+=o(e,t[s]),t[s].label&&(l+=r(e,t[s]));e.$content[0].innerHTML=l}function v(e){return function(){e.redraw()}}function x(e){return function(t){if(e.enabled){var i=w.getMarker(e,t.xy.x,t.xy.y);e.$content.find(".mouse-marker").remove(),e.$content.append($(n(e,i)).addClass("mouse-marker"))}}}function L(e){return function(t){var i,r=e.$content.offset(),a={x:t.clientX-r.left,y:t.clientY-r.top},o=w.getMarker(e,a.x,a.y);e.$content.find(".axis-hover-label").remove(),e.$content.find(".mouse-marker").remove(),i=$('<div class="axis-hover-label hover-label" style="'+e.leftOrTop+":"+o.pixel+'px;"><div class="hover-label-text">'+e.format(o.label,!0)+"</div></div>"),e.$content.append(i),e.isXAxis?(i.css(e.oppositePosition,-(i.outerHeight()+10)),i.css("margin-left",-i.outerWidth()/2)):(i.css(e.oppositePosition,-(i.outerWidth()+10)),i.css("margin-top",-i.outerHeight()/2)),e.$content.append($(n(e,o)).addClass("mouse-marker"))}}function b(e){return function(){e.$content.find(".axis-hover-label").remove(),e.$content.find(".mouse-marker").remove()}}function T(e){this.uuid=M.generateUuid(),this.position=void 0!==e.position?e.position.toLowerCase():"bottom",this.repeat=void 0!==e.repeat&&e.repeat,this.title=e.title||null,this.enabled=void 0===e.enabled||e.enabled,this.collapsible=void 0===e.collapsible||e.collapsible,e.intervals=e.intervals||{},this.intervals={},this.intervals.type=void 0!==e.intervals.type?e.intervals.type.toLowerCase():"percentage",this.intervals.increment=e.intervals.increment||10,this.intervals.pivot=e.intervals.pivot,this.intervals.scaleByZoom=void 0===e.intervals.scaleByZoom||e.intervals.scaleByZoom,this.intervals.minPixelWidth=void 0!==e.intervals.minPixelWidth&&e.intervals.minPixelWidth,e.units=e.units||{},this.units={},this.units.type=void 0!==e.units.type?e.units.type.toLowerCase():"decimal",this.units.decimals=e.units.decimals||2,this.units.stepDown=void 0===e.units.stepDown||e.units.stepDown,this.units.scale=e.units.scale||"linear",this.isXAxis="top"===this.position||"bottom"===this.position,this.axisWidthOrHeight=this.isXAxis?"width":"height",this.markerWidthOrHeight=this.isXAxis?"height":"width",
this.leftOrTop=this.isXAxis?"left":"top",this.horizontalOrVertical=this.isXAxis?"horizontal":"vertical",this.oppositePosition="left"===this.position?"right":"right"===this.position?"left":"top"===this.position?"bottom":"top"}var M=e("../util/Util"),I=e("../util/PubSub"),w=e("./AxisUtil"),C="axis-title-label",E="-axis",O="axis-header",A="-axis-header",k="axis-content",P="-axis-content",R="axis-marker-label",B="-axis-marker-label",U="axis-marker",S="-axis-marker",z="-axis",H=5,D=2001;T.prototype.activate=function(){this.redrawCallback=v(this),this.mouseMoveCallback=x(this),this.mouseHoverCallback=L(this),this.mouseOutCallback=b(this),this.map.on("move",this.redrawCallback),this.map.on("mousemove",this.mouseMoveCallback),this.$map=$(this.map.getElement()),this.$axis=m(this),this.$map.append(this.$axis),this.$axis.on("mousemove",this.mouseHoverCallback),this.$axis.on("mouseout",this.mouseOutCallback),u(this),this.title&&!this.enabled&&(this.enabled=!0,this.$header.click(),this.$content.finish())},T.prototype.deactivate=function(){this.map.off("move",this.redrawCallback),this.map.off("mousemove",this.mouseMoveCallback),this.$axis.off("mousemove",this.mouseHoverCallback),this.$axis.off("mouseout",this.mouseOutCallback),this.$axis.remove(),this.$axis=null,this.$title=null,this.$header=null,this.$content=null,this.redrawCallback=null,this.mouseMoveCallback=null,this.mouseHoverCallback=null,this.mouseOffCallback=null},T.prototype.isEnabled=function(){return this.enabled},T.prototype.setEnabled=function(e){this.enabled=e},T.prototype.getContentDimension=function(){var e=this.isXAxis?this.MAX_LABEL_HEIGHT:this.MAX_LABEL_WIDTH;return this.title&&(e+=this.HEADER_WIDTH),e+2*H+this.LARGE_MARKER_LENGTH},T.prototype.getMaxContentDimension=function(){var e=0;return _.forIn(this.map.axes,function(t){e=Math.max(t.getContentDimension()||0,e)}),e},T.prototype.updateDimension=function(){var e=this.isXAxis?"height":"width";this.$content[e](this.getMaxContentDimension(this.map))},T.prototype.redraw=function(){this.title&&f(this),this.isEnabled()&&(h(this),g(this))},T.prototype.format=function(e,t){return w.formatText(this,e,this.units,t)},T.prototype.getChannel=function(){return"axis."+this.position+"."+this.uuid},t.exports=T}()},{"../util/PubSub":59,"../util/Util":60,"./AxisUtil":43}],43:[function(e,t,i){!function(){"use strict";function i(e,t){var i;return i=e.repeat?t>e.max?t-e.max+e.min:t<e.min?t+e.max-e.min:t:t}function r(e,t){return e.isXAxis?b.getViewportPixelFromCoord(e.map,t,0).x:b.getViewportPixelFromCoord(e.map,0,t).y}function n(e,t,n,a){var o,s,l=1e-6*(n-t),h=a.subIncrement,u=a.startingMarkerTypeIndex,c={large:[],medium:[],small:[]},p=L.mod(u,T.length);for("time"!==e.units.type&&"date"!==e.units.type&&"i"!==e.units.type&&"int"!==e.units.type&&"integer"!==e.units.type&&(h-=l),o=t;o<=n;o+=h)s={pixel:r(e,o)},"large"===T[p]&&(s.label=i(e,o)),c[T[p]].push(s),p=(p+1)%T.length;return c}function a(e,t){var i,r;return i=e.isXAxis?b.getCoordFromViewportPixel(e.map,0,0).x:b.getCoordFromViewportPixel(e.map,0,e.map.getViewportHeight()).y,!e.repeat&&i<e.min&&(i=e.min),r=Math.ceil((i-t.pivot)/t.subIncrement,i),t.startingMarkerTypeIndex=r,t.pivot+t.subIncrement*r}function o(e,t){var i,r;return i=e.isXAxis?b.getCoordFromViewportPixel(e.map,e.map.getViewportWidth(),0).x:b.getCoordFromViewportPixel(e.map,0,0).y,!e.repeat&&i>e.max&&(i=e.max),r=Math.floor((i-t.pivot)/t.subIncrement,i),t.pivot+t.subIncrement*r}function s(e){return Math.round(e)}function l(e,t){return e.toExponential(t)}function h(e,t,i){var r=Math.pow(10,-t);return i&&e<r?l(e,t):L.roundToDecimals(e,t)}function u(e,t,i){var r=e/1e3;return i&&Math.abs(r)<1?h(e,t,!0):L.roundToDecimals(r,t)+"K"}function c(e,t,i){var r=e/1e6;return i&&Math.abs(r)<1?u(e,t,!0):L.roundToDecimals(r,t)+"M"}function p(e,t,i){var r=e/1e9;return i&&Math.abs(r)<1?c(e,t,!0):L.roundToDecimals(r,t)+"B"}function d(e,t,i){var r=moment.utc(t);if(i)return r.format("MMM D, h:mm:ssa");var n=moment.duration((e.max-e.min)/Math.pow(2,e.map.getZoom()));return n.asMonths()>16?r.format("YYYY"):n.asMonths()>2?r.format("MMM YYYY"):r.format("MMM D, YYYY")}function y(e,t){return h(e,t)+""}function m(e,t){var i=1,n=t/T.length;if(e.intervals.minPixelWidth)for(;Math.abs(r(e,t*i)-r(e,0))<e.intervals.minPixelWidth;)i*=2;return n*i}function f(e,t,i,n,a,o){if(a>=t&&a<=i){var s={pixel:r(e,a)};o&&(s.label=a),n.push(s)}}function g(e,t){if(t%1===0)return{unit:e,count:t};var i={};switch(e){case"year":i={unit:"month",count:12*t};break;case"month":i={unit:"week",count:4*t};break;case"week":i={unit:"day",count:7*t};break;case"day":i={unit:"hour",count:24*t};break;default:return console.error("Cannot split time units evenly"),null}return i.count%1!==0?g(i.unit,i.count):i}function v(e,t,i,r,n,a,o){var s,l,h,u,c,p,d,y=moment.utc(i).startOf(n).valueOf(),m=moment.duration(r-y),v=m.as(a+"s"),x=o>=1?o:1;for(p=0;p<v;p+=x){l=moment.utc(y).add(p,a).valueOf();var L=1/o;for(d=0;d<L;d++){var b=g(a,o);h=moment.utc(l).add(d*b.count,b.unit).valueOf(),f(e,i,r,t.large,h,!0),s=g(b.unit,b.count/2),u=moment.utc(h).add(s.count,s.unit+"s").valueOf(),f(e,i,r,t.medium,u),s=g(b.unit,b.count/4),c=moment.utc(h).add(s.count,s.unit+"s").valueOf(),f(e,i,r,t.small,c),c=moment.utc(h).add(3*s.count,s.unit+"s").valueOf(),f(e,i,r,t.small,c)}}}function x(e,t,i){var r=moment.duration((e.max-e.min)/Math.pow(2,e.map.getZoom())),n={large:[],medium:[],small:[]};return r.asMonths()>16?v(e,n,t,i,"year","year",1):r.asMonths()>8?v(e,n,t,i,"year","month",4):r.asMonths()>4?v(e,n,t,i,"year","month",2):r.asMonths()>2?v(e,n,t,i,"year","month",1):r.asMonths()>1?v(e,n,t,i,"year","month",.5):r.asWeeks()>2?v(e,n,t,i,"year","month",.25):r.asWeeks()>1?v(e,n,t,i,"year","day",4):r.asDays()>4?v(e,n,t,i,"year","day",2):v(e,n,t,i,"year","day",1),n}var L=e("../util/Util"),b=e("./MapUtil"),T=["large","small","medium","small"];t.exports={formatText:function(e,t,i,r){if(!i)return h(t,2);switch("log10"===i.scale&&(t=Math.pow(10,t)),i.type){case"degrees":case"degree":case"deg":return y(t,i.decimals);case"time":case"date":return d(e,t,r);case"k":case"thousand":case"thousands":return u(t,i.decimals,i.stepDown);case"m":case"million":case"millions":return c(t,i.decimals,i.stepDown);case"b":case"billion":case"billions":return p(t,i.decimals,i.stepDown);case"i":case"int":case"integer":return s(t);default:return h(t,i.decimals)}},getMarker:function(e,t,r){var n=e.isXAxis?"x":"y",a=e.isXAxis?t:r,o=b.getCoordFromViewportPixel(e.map,t,r)[n];return{value:o,label:i(e,o),pixel:a}},getMarkers:function(e){var t,i,r,s={};if("time"===e.units.type)return i=a(e,{pivot:e.min,subIncrement:36e5}),r=o(e,{pivot:e.min,subIncrement:36e5}),x(e,i,r);switch(e.intervals.type){case"value":case"fixed":case"#":t=e.intervals.increment,s.pivot=void 0!==e.intervals.pivot?e.intervals.pivot:e.min;break;default:t=e.intervals.increment,t=t>1?.01*t:t,t=(e.max-e.min)*t,s.pivot=void 0!==e.intervals.pivot?e.intervals.pivot:0,s.pivot>1&&(s.pivot=s.pivot/100),s.pivot=e.min+s.pivot*(e.max-e.min)}return e.intervals.scaleByZoom&&(t/=Math.pow(2,Math.max(e.map.getZoom()-1,0))),s.subIncrement=m(e,t),i=a(e,s),r=o(e,s),n(e,i,r,s)}}}()},{"../util/Util":60,"./MapUtil":45}],44:[function(e,t,i){!function(){"use strict";function i(e,t){t=t||{},t.options=t.options||{},t.theme=t.theme||"dark",this.id=e,this.setPyramid(t.pyramid),this.baseLayerIndex=-1,OpenLayers.Control.DragPan.prototype.enableKinetic=!1,this.navigationControls=new OpenLayers.Control.Navigation({documentDrag:!0,zoomBoxEnabled:!1}),this.zoomControls=new OpenLayers.Control.Zoom,this.olMap=new OpenLayers.Map(this.id,{theme:null,projection:new OpenLayers.Projection("EPSG:900913"),displayProjection:new OpenLayers.Projection("EPSG:4326"),maxExtent:OpenLayers.Bounds.fromArray([-20037508.342789244,-20037508.342789244,20037508.342789244,20037508.342789244]),zoomMethod:null,units:t.options.units||"m",numZoomLevels:t.options.numZoomLevels||18,fallThrough:!0,controls:[this.navigationControls,this.zoomControls],tileManager:OpenLayers.TileManager?new OpenLayers.TileManager({moveDelay:void 0!==t.options.moveDelay?t.options.moveDelay:400,zoomDelay:void 0!==t.options.zoomDelay?t.options.zoomDelay:400}):void 0}),this.showPendingTiles=void 0===t.showPendingTiles||t.showPendingTiles,this.setTheme(t.theme)}var r,n,a,o,s,l,h,u,c,p,d,y,m,f=e("./Axis"),g=e("../layer/PendingLayer"),v=e("./MapUtil"),x=e("../layer/Layer"),L=e("../layer/Carousel"),b=e("../layer/BaseLayer"),T=e("../util/PubSub"),M=e("../binning/AreaOfInterestTilePyramid"),I=e("../binning/WebMercatorTilePyramid"),w=e("../binning/TileIterator"),C=256,E=5e3;r=function(e){function t(t,i){var r=v.getTileAndBinFromViewportPixel(e,t,i,1,1),n=r.tile.level+","+r.tile.xIndex+","+r.tile.yIndex;n!==e.tileFocus&&(e.previousTileFocus=e.tileFocus,e.tileFocus=n,T.publish("layer",{field:"tileFocus",value:n}))}var i={};e.on("mousemove",function(e){t(e.xy.x,e.xy.y),i.x=e.xy.x,i.y=e.xy.y}),e.on("zoomend",function(){t(i.x,i.y)}),e.olMap.events.register("mousedown",e,function(){e.olMap.panTween&&(e.olMap.panTween.callbacks=null,e.olMap.panTween.stop())},!0),e.resizeCallback=function(){e.olMap.updateSize()},$(window).on("resize",e.resizeCallback)},n=function(e,t){if(t instanceof L)h(e,t);else if(t instanceof x){if(t.carousel)return void console.log("You cannot add a layer that is part of a carousel to a map independently, remove it from the carousel first.");l(e,t)}else t instanceof f&&u(e,t)},a=function(e,t){t instanceof b?c(e,t):t instanceof L?d(e,t):t instanceof x?p(e,t):t instanceof f&&y(e,t)},o=function(e){var t;for(t=0;t<e.deferreds.length;t++)n(e,e.deferreds[t]);delete e.deferreds},s=function(e,t){t.map=e,e.baselayers=e.baselayers||[],e.baselayers.push(t),e.baseLayerIndex<0&&(e.setBaseLayerIndex(0),e.olMap.zoomToMaxExtent(),r(e),e.showPendingTiles&&(e.pendingLayer=new g,e.pendingLayer.map=e,e.pendingLayer.activate()),e.deferreds&&o(e))},l=function(e,t){t.map=e,e.showPendingTiles&&t.showPendingTiles&&e.pendingLayer.register(t),t.activate(),e.layers=e.layers||[],e.layers.push(t),e.layersById=e.layersById||{},e.layersById[t.getUUID()]=t},h=function(e,t){t.map=e,t.activate(),e.carousels=e.carousels||[],e.carousels.push(t),e.carouselsById=e.carouselsById||{},e.carouselsById[t.getUUID()]=t},u=function(e,t){"top"===t.position||"bottom"===t.position?(t.min=e.pyramid.minX,t.max=e.pyramid.maxX):(t.min=e.pyramid.minY,t.max=e.pyramid.maxY),t.map=e,t.activate(),e.axes=e.axes||{},e.axes[t.position]=t,_.forIn(e.axes,function(e){e.updateDimension()}),_.forIn(e.axes,function(e){e.redraw()})},c=function(e,t){var i;return e.destroying||1!==e.baselayers.length?(i=e.baselayers.indexOf(t),e.baselayers.splice(i,1),i===e.baseLayerIndex?(i=e.baselayers[i]?i:i-1,e.setBaseLayerIndex(i)):i<e.baseLayerIndex&&e.baseLayerIndex--,void(t.map=null)):void console.error("Error: attempting to remove only baselayer from map, this destroys the map, use destroy() instead")},p=function(e,t){var i=e.layers.indexOf(t);i!==-1&&(delete e.layersById[t.getUUID()],e.layers.splice(i,1),e.showPendingTiles&&e.pendingLayer.unregister(t),t.deactivate(),t.map=null,m(e))},d=function(e,t){var i=e.carousels.indexOf(t);i!==-1&&(delete e.carouselsById[t.getUUID()],e.carousels.splice(i,1),t.deactivate(),t.map=null,m(e))},y=function(e,t){delete e.axes[t.position],t.deactivate(),t.map=null},m=function(e){var t,i,r=e.layers;if(e.layers)for(i=0;i<r.length;i++)r[i].setZIndex(r[i].getZIndex());e.baseLayerIndex>=0&&(t=e.baselayers[e.baseLayerIndex],t.resetZIndex()),e.olMarkers&&$(e.olMarkers.div).css("z-index",E)},i.prototype={destroy:function(){this.destroying=!0,this.pendingLayer&&(this.pendingLayer.deactivate(),this.pendingLayer.map=null,this.pendingLayer=null),this.olMarkers&&(this.olMap.removeLayer(this.olMarkers),this.olMarkers=null),this.layers.forEach(function(e){this.remove(e)},this),_.forIn(this.axes,function(e){this.remove(e)},this),this.baselayers.forEach(function(e){this.remove(e)},this),$(window).off("resize",this.resizeCallback),this.olMap.destroy()},add:function(e){return e instanceof b?void s(this,e):this.baseLayerIndex<0?(this.deferreds=this.deferreds||[],void this.deferreds.push(e)):void n(this,e)},remove:function(e){return this.baseLayerIndex<0?(this.deferreds=this.deferreds||[],void this.deferreds.splice(this.deferreds.indexOf(e),1)):void a(this,e)},enableNavigation:function(){this.navigationControls.activate()},disableNavigation:function(){this.navigationControls.deactivate()},getTileFocus:function(){return this.tileFocus},setBaseLayerIndex:function(e){var t=this.baselayers[this.baseLayerIndex],i=this.baselayers[e];return i?void(t!==i&&(t&&t.deactivate(),i.activate(),this.baseLayerIndex=e,m(this),T.publish(i.getChannel(),{field:"baseLayerIndex",value:e}))):void console.error("Error, no baselayer for supplied index: "+e)},getBaseLayerIndex:function(){return this.baseLayerIndex},getActiveBaseLayer:function(){return this.baseLayerIndex===-1?null:this.baselayers[this.baseLayerIndex]},setTheme:function(e){if(this.theme!==e){var t;if("light"===e?$("body").removeClass("dark-theme").addClass("light-theme"):$("body").removeClass("light-theme").addClass("dark-theme"),this.theme=e,this.layers)for(t=0;t<this.layers.length;t++)this.layers[t].setTheme&&this.layers[t].setTheme(e)}},getTheme:function(){return this.theme},getElement:function(){return this.olMap.div},getViewportElement:function(){return this.olMap.viewPortDiv},getContainerElement:function(){return this.olMap.layerContainerDiv},setPyramid:function(e){e?e instanceof M||e instanceof I?this.pyramid=e:e.type&&"areaofinterest"===e.type.toLowerCase()?this.pyramid=new M(e):this.pyramid=new I:this.pyramid=new I},getPyramid:function(){return this.pyramid},getTileIterator:function(){var e=this.olMap.getZoom(),t=this.olMap.getExtent(),i=this.olMap.getMaxExtent(),r=new M({minX:i.left,minY:i.bottom,maxX:i.right,maxY:i.top});return new w({pyramid:r,level:e,minX:t.left,minY:t.bottom,maxX:t.right,maxY:t.top})},getTilesInView:function(){var e,t,i=this.getTileIterator().getRest(),r=[],n=Math.pow(2,this.getZoom());for(t=0;t<i.length;t++)e=i[t],e.xIndex>=0&&e.yIndex>=0&&e.xIndex<n&&e.yIndex<n&&r.push(e.level+","+e.xIndex+","+e.yIndex);return r},zoomTo:function(e,t,i){var r=v.getViewportPixelFromCoord(this,e,t),n=this.olMap.getLonLatFromViewPortPx(r);this.olMap.setCenter(n,i)},zoomToExtent:function(e){var t=v.getViewportPixelFromCoord(this,e.minX,e.minY),i=v.getViewportPixelFromCoord(this,e.maxX,e.maxY),r=this.olMap.getLonLatFromViewPortPx(t),n=this.olMap.getLonLatFromViewPortPx(i),a=new OpenLayers.Bounds;a.extend(r),a.extend(n),this.olMap.zoomToExtent(a)},restrictExtent:function(e){if(!e)return this.olMap.restrictedExtent=null,void this.olMap.zoomToMaxExtent();var t=v.getViewportPixelFromCoord(this,e.minX,e.minY),i=v.getViewportPixelFromCoord(this,e.maxX,e.maxY),r=this.olMap.getLonLatFromViewPortPx(t),n=this.olMap.getLonLatFromViewPortPx(i),a=new OpenLayers.Bounds;a.extend(r),a.extend(n),this.olMap.restrictedExtent=a,this.olMap.zoomToExtent(a)},panTo:function(e,t){var i=v.getViewportPixelFromCoord(this,e,t),r=this.olMap.getLonLatFromViewPortPx(i);this.olMap.panTo(r)},addMarker:function(e,t,i){return this.olMarkers||(this.olMarkers=new OpenLayers.Layer.Markers("Markers"),this.olMap.addLayer(this.olMarkers)),$(this.olMarkers.div).css("z-index",5e3),i.map=this,i.activate(e,t),i},removeMarker:function(e){this.olMarkers&&(e.deactivate(),e.map=null)},clearMarkers:function(){this.olMarkers&&this.olMarkers.clearMarkers()},getWidth:function(){return C*Math.pow(2,this.getZoom())},getHeight:function(){return C*Math.pow(2,this.getZoom())},getViewportWidth:function(){return this.olMap.viewPortDiv.clientWidth},getViewportHeight:function(){return this.olMap.viewPortDiv.clientHeight},getZoom:function(){return this.olMap.getZoom()},getCenterProjected:function(){return v.getCoordFromViewportPixel(this,this.getViewportWidth()/2,this.getViewportHeight()/2)},getMapExtents:function(){return{topLeft:v.getCoordFromViewportPixel(this,0,0),bottomRight:v.getCoordFromViewportPixel(this,this.getViewportWidth(),this.getViewportHeight())}},on:function(e,t){this.olMap.events.register(e,this.olMap,t)},off:function(e,t){this.olMap.events.unregister(e,this.olMap,t)},trigger:function(e,t){this.olMap.events.triggerEvent(e,t)}},t.exports=i}()},{"../binning/AreaOfInterestTilePyramid":2,"../binning/TileIterator":3,"../binning/WebMercatorTilePyramid":4,"../layer/BaseLayer":7,"../layer/Carousel":8,"../layer/Layer":15,"../layer/PendingLayer":18,"../util/PubSub":59,"./Axis":42,"./MapUtil":45}],45:[function(e,t,i){!function(){"use strict";var i,r=e("../util/Util"),n=256;i=function(e){var t=e.olMap;return{min:t.getViewPortPxFromLonLat(new OpenLayers.LonLat(t.maxExtent.left,t.maxExtent.bottom)),max:t.getViewPortPxFromLonLat(new OpenLayers.LonLat(t.maxExtent.right,t.maxExtent.top))}},t.exports={getViewportPixelFromCoord:function(e,t,i){var r=this.getMapPixelFromCoord(e,t,i);return this.getViewportPixelFromMapPixel(e,r.x,r.y)},getViewportPixelFromMapPixel:function(e,t,r){var n=i(e);return{x:t+n.min.x,y:e.getWidth()-r+n.max.y}},getMapPixelFromCoord:function(e,t,i){var r=e.pyramid.rootToFractionalTile(t,i,e.getZoom(),n),a=e.pyramid.rootToFractionalBin(t,i,r);return{x:r.xIndex*n+a.x,y:r.yIndex*n+n-1-a.y}},getMapPixelFromViewportPixel:function(e,t,r){var n=i(e),a=e.getWidth();return{x:a+t-n.max.x,y:a-r+n.max.y}},getCoordFromMapPixel:function(e,t,i){var r=this.getTileAndBinFromMapPixel(e,t,i,n,n),a=e.pyramid.getBinBounds(r.tile,r.bin);return{x:a.minX,y:a.minY}},getCoordFromViewportPixel:function(e,t,i){var r=this.getMapPixelFromViewportPixel(e,t,i);return this.getCoordFromMapPixel(e,r.x,r.y)},getTileAndBinFromViewportPixel:function(e,t,i,r,n){var a=this.getMapPixelFromViewportPixel(e,t,i);return this.getTileAndBinFromMapPixel(e,a.x,a.y,r,n)},getTileAndBinFromMapPixel:function(e,t,i,a,o){var s=Math.floor(t/n),l=Math.floor(i/n),h=r.mod(t,n),u=r.mod(i,n);return{tile:{level:e.getZoom(),xIndex:s,yIndex:l,xBinCount:a,yBinCount:o},bin:{x:Math.floor(h/(n/a)),y:o-1-Math.floor(u/(n/o))}}},getTileAndBinFromCoord:function(e,t,i,r,n){var a=this.getMapPixelFromCoord(e,t,i);return this.getTileAndBinFromMapPixel(e,a.x,a.y,r,n)},getTopLeftViewportPixelForTile:function(e,t){var i=this.getTopLeftMapPixelForTile(e,t);return this.getViewportPixelFromMapPixel(e,i.x,i.y)},getTopLeftMapPixelForTile:function(e,t){var i=t.split(","),r=parseInt(i[1],10),a=parseInt(i[2],10),o=r*n,s=a*n+n;return{x:o,y:s}},getTopLeftCoordForTile:function(e,t){var i=this.getTopLeftMapPixelForTile(e,t);return this.getCoordFromMapPixel(e,i.x,i.y)}}}()},{"../util/Util":60}],46:[function(e,t,i){!function(){"use strict";function i(e,t,i){this.width=t||50,this.height=i||50,this.icon=new OpenLayers.Icon(e,new OpenLayers.Size(this.width,this.height),new OpenLayers.Pixel(-this.width/2,(-this.height)))}var r=e("./MapUtil");i.prototype={activate:function(e,t){this.x=e,this.y=t;var i=r.getViewportPixelFromCoord(this.map,e,t),n=this.map.olMap.getLonLatFromViewPortPx(i);this.olMarker=new OpenLayers.Marker(n,this.icon.clone()),this.map.olMarkers.addMarker(this.olMarker)},deactivate:function(){this.olMarker&&this.map.olMarkers&&(this.map.olMarkers.removeMarker(this.olMarker),this.olMarker.destroy(),this.olMarker=null,this.x=null,this.y=null)},getElement:function(){return this.olMarker?this.olMarker.icon.imageDiv:null}},t.exports=i}()},{"./MapUtil":45}],47:[function(e,t,i){!function(){"use strict";var i=e("../util/Util");t.exports={getTileJSON:function(e,t,r,n,a,o){var s="object"==typeof a?a:null,l="function"==typeof o?o:"function"==typeof a?a:null;$.get("rest/v1.0/annotation/"+e+"/"+t+"/"+r+"/"+n+".json"+i.encodeQueryParams(s)).then(l,i.handleHTTPError)},writeAnnotation:function(e,t,r){var n="function"==typeof r?r:null;$.post("rest/v1.0/annotation",JSON.stringify({type:"write",annotation:t,layer:e})).then(n,i.handleHTTPError)},modifyAnnotation:function(e,t,r){var n="function"==typeof r?r:null;$.post("rest/v1.0/annotation",JSON.stringify({type:"modify",annotation:t,layer:e})).then(n,i.handleHTTPError)},removeAnnotation:function(e,t,r){var n="function"==typeof r?r:null;$.post("rest/v1.0/annotation",JSON.stringify({type:"remove",certificate:t,layer:e})).then(n,i.handleHTTPError)}}}()},{"../util/Util":60}],48:[function(e,t,i){!function(){"use strict";var i=e("../util/Util");t.exports={getLayers:function(e){var t="function"==typeof e?e:null;$.get("rest/v1.0/layers").then(t,i.handleHTTPError)},getLayer:function(e,t){var r="function"==typeof t?t:null;$.get("rest/v1.0/layers/"+e).then(r,i.handleHTTPError)},saveLayerState:function(e,t,r){var n="function"==typeof r?r:null;$.post("rest/v1.0/layers/"+e+"/states",JSON.stringify(t)).then(n,i.handleHTTPError)},getLayerStates:function(e,t){var r="function"==typeof t?t:null;$.get("rest/v1.0/layers/"+e+"/states").then(r,i.handleHTTPError)},getLayerState:function(e,t,r){var n="function"==typeof r?r:null;$.get("rest/v1.0/layers/"+e+"/states/"+t).then(n,i.handleHTTPError)}}}()},{"../util/Util":60}],49:[function(e,t,i){!function(){"use strict";var i=e("../util/Util");t.exports={getEncodedImage:function(e,t,r){var n="object"==typeof t?t:null,a="function"==typeof r?r:"function"==typeof t?t:null;$.get("rest/v1.0/legend/"+e+i.encodeQueryParams(n)).then(a,i.handleHTTPError)},getImage:function(e,t,r){var n="object"==typeof t?t:{},a="function"==typeof r?r:"function"==typeof t?t:null;n.output="png",$.get("rest/v1.0/legend/"+e+i.encodeQueryParams(n)).then(a,i.handleHTTPError)}}}()},{"../util/Util":60}],50:[function(e,t,i){!function(){"use strict";var i=e("../util/Util");t.exports={getTileJSON:function(e,t,r,n,a,o){var s="object"==typeof a?a:null,l="function"==typeof o?o:"function"==typeof a?a:null;$.get("rest/v1.0/tile/"+e+"/"+t+"/"+r+"/"+n+".json"+i.encodeQueryParams(s)).then(l,i.handleHTTPError)},getTileImage:function(e,t,r,n,a,o){var s="object"==typeof a?a:null,l="function"==typeof o?o:"function"==typeof a?a:null;$.get("rest/v1.0/tile/"+e+"/"+t+"/"+r+"/"+n+".png"+i.encodeQueryParams(s)).then(l,i.handleHTTPError)}}}()},{"../util/Util":60}],51:[function(e,t,i){!function(){"use strict";var i=e("../util/PubSub");t.exports={create:function(e){var t,r,n=$('<div class="coarseness-controls"></div>'),a=$('<div class="controls-label">Coarseness</div>'),o=$('<div class="control-menu">'),s=$('<ul class="dropdown-menu"></ul>'),l=function(){e.setCoarseness($(this).data("coarseness")),s.children().each(function(){$(this).removeClass("active")}),$(this).addClass("active")},h=function(e){s.children().each(function(){$(this).removeClass("active"),$(this).data("coarseness")===e&&$(this).addClass("active")})},u=[{id:1,name:"1x1"},{id:2,name:"2x2"},{id:3,name:"4x4"},{id:4,name:"8x8"}];for(s.click(function(){s.toggleClass("dropdown-menu-open")}),r=0;r<u.length;r++)t=$('<li class="menu-item"><a href="#" class="menu-item-link">'+u[r].name+"</a></li>"),t.data("coarseness",u[r].id),t.click(l),s.append(t);return h(e.getCoarseness()),i.subscribe(e.getChannel(),function(e){"coarseness"===e.field&&h(e.value)}),n.append(a),n.append(o.append(s)),n}}}()},{"../util/PubSub":59}],52:[function(e,t,i){!function(){"use strict";function i(e,t){var i=5;return $('<div class="filter-axis"></div>').append(r(i)).append(n(i,e,t))}function r(e){var t,i=$('<div class="filter-axis-ticks-container"></div>'),r=2*(e-1),n=100/r,a=!0;for(t=0;t<r;t++)a?i.append('<div class="filter-axis-marker filter-major-marker" style="margin-right:calc('+n+'% - 1px);"></div>'):i.append('<div class="filter-axis-marker filter-minor-marker" style="margin-right:calc('+n+'% - 1px);"></div>'),a=!a;return i.append('<div class="filter-axis-marker filter-major-marker" style="margin-left:-1px;"></div>'),i}function n(e,t,i){var r,n,a=$('<div class="filter-axis-label-container"></div>'),l=100/(e-1),h={stepDown:!0,decimals:1,type:"b"};for(n=0;n<e;n++)r=o.denormalizeValue(n/(e-1),t,i),a.append($('<div class="filter-axis-label" style="position:absolute; left:'+l*n+"%; width:"+l+"%; margin-left:-"+l/2+'%;">'+s.formatText(r,h)+"</div>"));return a}var a=e("./SliderUtil"),o=e("../util/Util"),s=e("../map/AxisUtil"),l=e("../util/PubSub");t.exports={create:function(e){var t=$('<div class="filter-controls"></div>'),r=$('<div class="controls-label">Filter</div>'),n=$('<div class="slider-border">'),s=$('<div class="filter-slider"></div>'),h=0,u=100;return s.slider({range:!0,min:h,max:u,values:[e.getRangeMinPercentage()*u,e.getRangeMaxPercentage()*u],change:function(){var t=$(this).slider("option","values");e.setRangeMinPercentage(t[0]/u),e.setRangeMaxPercentage(t[1]/u)},slide:function(t,i){var r=$(i.handle).index()-1,n=i.values,l=o.denormalizeValue(n[r]/u,e.getLevelMinMax(),e.getValueTransformType());a.createLabel($(s[0].children[1+r]),l)},start:function(t,i){var r=$(i.handle).index()-1,n=i.values,l=o.denormalizeValue(n[r]/u,e.getLevelMinMax(),e.getValueTransformType());a.createLabel($(s[0].children[1+r]),l)},stop:function(e,t){var i=$(t.handle).index()-1,r=$(s[0].children[1+i]);r.is(":hover")||a.removeLabel(r)}}),s.find(".ui-slider-handle").each(function(t,i){$(i).mouseover(function(){var i=0===t?e.getRangeMinValue():e.getRangeMaxValue();a.createLabel($(this),i)}),$(i).mouseout(function(){a.removeLabel($(this))})}),s.append(i(e.getLevelMinMax(),e.getValueTransformType())),s.find(".ui-slider-handle").first().addClass("filter-min-handle"),s.find(".ui-slider-handle").last().addClass("filter-max-handle"),t.append(r),t.append(n.append(s)),l.subscribe(e.getChannel(),function(t){switch(t.field){case"rangeMin":s.slider("values",0,e.getRangeMinPercentage()*u);break;case"rangeMax":s.slider("values",1,e.getRangeMaxPercentage()*u);break;case"rampImageUrl":s.find(".ui-slider-range").css({background:"url("+t.value+")","background-size":"contain"});break;case"levelMinMax":s.find(".filter-axis").replaceWith(i(e.getLevelMinMax(),e.getValueTransformType()))}}),t}}}()},{"../map/AxisUtil":43,"../util/PubSub":59,"../util/Util":60,"./SliderUtil":58}],53:[function(e,t,i){!function(){"use strict";var i=e("./LayerEntry");t.exports={create:function(e){var t=$('<div class="tiles-layer-controls"></div>');return _.forEach(e,function(e){t.append(i.create(e))}),t}}}()},{"./LayerEntry":54}],54:[function(e,t,i){!function(){"use strict";var i=e("./LayerEntryHead"),r=e("./LayerEntryBody"),n=e("../util/PubSub");t.exports={create:function(e){var t=$('<div class="layer-entry"></div>'),a=i.create(e),o=r.create(e);return n.subscribe(e.getChannel(),function(e){"enabled"===e.field&&(e.value?o.css("display",""):o.css("display","none"))}),e.isEnabled()?o.css("display",""):o.css("display","none"),t.append(a),t.append(o),t}}}()},{"../util/PubSub":59,"./LayerEntryBody":55,"./LayerEntryHead":56}],55:[function(e,t,i){!function(){"use strict";var i=e("./OpacityControls"),r=e("./FilterControls"),n=e("./CoarsenessControls");t.exports={create:function(e){var t=$('<div class="layer-entry-body"></div>');return"client"===e.domain||"annotation"===e.domain?t.append(i.create(e).addClass("opacity-controls-client")):(t.append(i.create(e).addClass("opacity-controls-server")),t.append(r.create(e)),t.append(n.create(e))),t.append('<div class="clear"></div>'),t}}}()},{"./CoarsenessControls":51,"./FilterControls":52,"./OpacityControls":57}],56:[function(e,t,i){!function(){"use strict";var i=e("../util/PubSub");t.exports={create:function(e){var t="fa-check-square-o",r="fa-square-o",n=e.isEnabled()?t:r,a=$('<div class="layer-entry-head"></div>'),o=$('<i class="fa '+n+'"></i>'),s=$('<div class="layer-toggle"></div>'),l=$('<div class="layer-title">'+e.source.name+"</div>");return a.click(function(){e.isEnabled()?e.setEnabled(!1):e.setEnabled(!0)}),i.subscribe(e.getChannel(),function(e){"enabled"===e.field&&(e.value?(o.removeClass(r),o.addClass(t)):(o.removeClass(t),o.addClass(r)))}),a.append(s.append(o)),a.append(l),a}}}()},{"../util/PubSub":59}],57:[function(e,t,i){!function(){"use strict";var i=e("./SliderUtil"),r=e("../util/PubSub");t.exports={create:function(e){var t=$('<div class="opacity-controls"></div>'),n=$('<div class="controls-label">Opacity</div>'),a=$('<div class="slider-border">'),o=$('<div class="opacity-slider"></div>'),s=0,l=100;return o.slider({range:"min",min:s,max:l,value:e.getOpacity()*l,slide:function(t,r){$(".olTileImage").addClass("no-transition"),$(".olTileHtml").addClass("no-transition"),e.setOpacity(r.value/l),i.createLabel($(this).find(".ui-slider-handle"),r.value/l)},start:function(e,t){i.createLabel($(this).find(".ui-slider-handle"),t.value/l)},stop:function(){var e=$(this).find(".ui-slider-handle");e.is(":hover")||i.removeLabel(e),$(".olTileImage").removeClass("no-transition"),$(".olTileHtml").removeClass("no-transition")}}),o.find(".ui-slider-handle").mouseover(function(){i.createLabel($(this),e.getOpacity())}),o.find(".ui-slider-handle").mouseout(function(){i.removeLabel($(this))}),r.subscribe(e.getChannel(),function(t){"opacity"===t.field&&o.slider("value",e.getOpacity()*l)}),t.append(n),t.append(a.append(o)),t}}}()},{"../util/PubSub":59,"./SliderUtil":58}],58:[function(e,t,i){!function(){"use strict";var i=e("../map/AxisUtil");t.exports={createLabel:function(e,t){var r={stepDown:!0,decimals:2,type:"b"},n=$('<div class="hover-label" style="left:'+e.width()/2+'px; top:0px;"><div class="hover-label-text">'+i.formatText(t,r)+"</div></div>");e.find(".hover-label").finish().remove(),e.append(n),n.css({"margin-top":1.2*-n.outerHeight(),"margin-left":-n.outerWidth()/2})},removeLabel:function(e){e.find(".hover-label").animate({opacity:0},{complete:function(){e.find(".hover-label").remove()},duration:800})}}}()},{"../map/AxisUtil":43}],59:[function(e,t,i){!function(){"use strict";function e(e){return{path:e,subscribers:[],children:{}}}t.exports={subscribe:function(t,i){var r,n,a=t.split("."),o="";for(this.channels=this.channels||{subscribers:[],children:{}},n=this.channels;a.length>0;)r=a.shift(),o+=o.length>0?"."+r:r,n.children[r]||(n.children[r]=e(o)),n=n.children[r];n.subscribers.push(i)},unsubscribe:function(t,i){var r,n,a=t.split("."),o="";for(this.channels=this.channels||{subscribers:[],children:{}},n=this.channels;a.length>0;)r=a.shift(),o+=o.length>0?"."+r:r,n.children[r]||(n.children[r]=e(o)),n=n.children[r];var s=n.subscribers.indexOf(i);s!==-1&&n.subscribers.splice(s,1)},publish:function(t,i){for(var r,n,a,o,s,l,h=t.split("."),u=[],c="",p=this.channels||{subscribers:[],children:{}};h.length>0;)a=h.shift(),c+=c.length>0?"."+a:a,p.children[a]||(p.children[a]=e(c)),p=p.children[a],u.push(p);for(l=u.pop();u.length>0;)for(p=u.shift(),n=p.subscribers,o=0;o<n.length;o++)n[o](i,t);for(u=[l];u.length>0;){for(p=u.shift(),n=p.subscribers,r=p.children,o=0;o<n.length;o++)n[o](i,t);for(s in r)r.hasOwnProperty(s)&&u.push(r[s])}}}}()},{}],60:[function(e,t,i){!function(){"use strict";var e;e=function(e){var t,i,r,n=new e.constructor(e.type,e);t=e.currentTarget,i=t.style["pointer-events"],t.style["pointer-events"]="none",r=document.elementFromPoint(e.clientX,e.clientY),r&&r.dispatchEvent(n),t.style["pointer-events"]=i},t.exports={generateUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"===e?t:3&t|8;return i.toString(16)})},enableEventPropagation:function(t,i){var r,n=t instanceof $?t[0]:t;if(i)for(i=i instanceof Array?i:[i],r=0;r<i.length;r++)n.addEventListener(i[r],e);else n.addEventListener("mousedown",e),n.addEventListener("mouseup",e),n.addEventListener("mousemove",e),n.addEventListener("wheel",e),n.addEventListener("scroll",e),n.addEventListener("click",e),n.addEventListener("dblclick",e)},disableEventPropagation:function(t,i){var r,n=t instanceof $?t[0]:t;if(i)for(i=i instanceof Array?i:[i],r=0;r<i.length;r++)n.removeEventListener(i[r],e);else n.removeEventListener("mousedown",e),n.removeEventListener("mouseup",e),n.removeEventListener("mousemove",e),n.removeEventListener("wheel",e),n.removeEventListener("scroll",e),n.removeEventListener("click",e),n.removeEventListener("dblclick",e)},mod:function(e,t){return(e%t+t)%t},roundTowards:function(e,t){return e<t?Math.ceil(e):Math.floor(e)},roundToDecimals:function(e,t){var i=t||2,r=Math.pow(10,i);
return parseFloat(Math.round(e*r)/r).toFixed(t)},denormalizeValue:function(e,t,i){function r(e){return Math.log(e)/Math.LN10}var n,a=t.maximum-t.minimum;if("log10"===i){var o=0===t.minimum?0:r(t.minimum),s=0===t.maximum?0:r(t.maximum);n=Math.pow(10,o+(s-o)*e)}else n=e*a+t.minimum;return n},normalizeValue:function(e,t,i){function r(e){return Math.log(e)/Math.LN10}function n(e){return 0===e||1===e?0:r(e)/r(e)}var a,o=t.maximum-t.minimum;return a="log10"===i?n(t.maximum):(e-t.minimum)/o},timeSensitiveClick:function(e,t,i){var r=0;e.addEventListener("click",function(n){r++,1===r&&setTimeout(function(){1===r&&t.call(e,n),r=0},i||300)})},dragSensitiveClick:function(e,t,i){var r={x:null,y:null};i=i||10,e.addEventListener("mousedown",function(e){r.x=e.pageX,r.y=e.pageY}),e.addEventListener("click",function(e){Math.abs(r.x-e.pageX)<i&&Math.abs(r.y-e.pageY)<i&&t.call(this,e)})},dragAndTimeSensitiveClick:function(e,t){var i={x:null,y:null},r=r||10;e.addEventListener("mousedown",function(e){i.x=e.pageX,i.y=e.pageY}),this.timeSensitiveClick(e,function(e){Math.abs(i.x-e.pageX)<r&&Math.abs(i.y-e.pageY)<r&&t.call(this,e)})},getURLParameters:function(){var e,t,i=window.location.search.substring(1),r=i.split("&"),n={};for(t=0;t<r.length;++t)e=r[t].split("="),n[e[0]]=e[1];return n},getURLParameter:function(e){return this.getURLParameters()[e]},handleHTTPError:function(e){console.error(e.responseText),console.error(e)},encodeQueryParams:function(e){function t(e,i){var r="";return _.forIn(e,function(n,a){r+="object"!=typeof n?i+a+"="+n+"&":t(e[a],i+a+".")}),"."!==r[0]?r:""}var i;return i="?"+t(e,""),i.slice(0,i.length-1)},fillArray:function(e,t){t=void 0!==t?t:0;var i,r=[];for(i=0;i<e;i++)r.push(t);return r},fillArrayByFunc:function(e,t){var i,r=[];for(i=0;i<e;i++)r.push(t());return r},isEmpty:function(e){var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0},extend:function(e,t){var i;for(i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}}}()},{}]},{},[1])(1)});